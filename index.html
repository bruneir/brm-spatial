<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Haziq Jamil">
<meta name="dcterms.date" content="2023-03-09">

<title>Analysing spatial data using R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link active" data-scroll-target="#preliminaries">Preliminaries</a>
  <ul class="collapse">
  <li><a href="#expectations" id="toc-expectations" class="nav-link" data-scroll-target="#expectations">Expectations</a></li>
  <li><a href="#clone-this-repo-from-github" id="toc-clone-this-repo-from-github" class="nav-link" data-scroll-target="#clone-this-repo-from-github">Clone this repo from GitHub</a></li>
  <li><a href="#getting-started-with-r" id="toc-getting-started-with-r" class="nav-link" data-scroll-target="#getting-started-with-r">Getting started with R</a></li>
  <li><a href="#list-of-packages" id="toc-list-of-packages" class="nav-link" data-scroll-target="#list-of-packages">List of packages</a></li>
  </ul></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#types-of-gis-data" id="toc-types-of-gis-data" class="nav-link" data-scroll-target="#types-of-gis-data">Types of GIS data</a></li>
  </ul></li>
  <li><a href="#multipoint-data" id="toc-multipoint-data" class="nav-link" data-scroll-target="#multipoint-data"><code>(MULTI)POINT</code> data</a>
  <ul class="collapse">
  <li><a href="#clean-up-the-point-data" id="toc-clean-up-the-point-data" class="nav-link" data-scroll-target="#clean-up-the-point-data">Clean up the point data</a></li>
  <li><a href="#preliminary-plot-of-the-data" id="toc-preliminary-plot-of-the-data" class="nav-link" data-scroll-target="#preliminary-plot-of-the-data">Preliminary plot of the data</a></li>
  <li><a href="#merge-with-the-study-data" id="toc-merge-with-the-study-data" class="nav-link" data-scroll-target="#merge-with-the-study-data">Merge with the study data</a></li>
  <li><a href="#predictive-models" id="toc-predictive-models" class="nav-link" data-scroll-target="#predictive-models">Predictive models</a></li>
  </ul></li>
  <li><a href="#line-data-multilinestring" id="toc-line-data-multilinestring" class="nav-link" data-scroll-target="#line-data-multilinestring">Line data (<code>(MULTI)LINESTRING</code>)</a>
  <ul class="collapse">
  <li><a href="#road-networks-in-belait-region" id="toc-road-networks-in-belait-region" class="nav-link" data-scroll-target="#road-networks-in-belait-region">Road networks in Belait region</a></li>
  </ul></li>
  <li><a href="#areal-data-multipolygons" id="toc-areal-data-multipolygons" class="nav-link" data-scroll-target="#areal-data-multipolygons">Areal data (<code>(MULTI)POLYGONS</code>)</a></li>
  </ul>
<div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://bruneir.github.io"><i class="bi bi-link-45deg"></i>Brunei R website</a></li></ul></div><div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/bruneir/brm-spatial/" target="_blank"><i class="bi bi-github"></i>GitHub Repo</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Analysing spatial data using R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Brunei R User Group Meetup 🇧🇳</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://haziqj.ml">Haziq Jamil, PhD</a> <a href="mailto:haziq.jamil@ubd.edu.bn" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0003-3298-1010" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Universiti Brunei Darussalam
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 9, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="httpsbruneir.github.iobrm-spatial" class="level3 unlisted">
<h3 class="unlisted anchored" data-anchor-id="httpsbruneir.github.iobrm-spatial"><code>https://bruneir.github.io/brm-spatial</code></h3>
</section>
<section id="preliminaries" class="level2">
<h2 class="anchored" data-anchor-id="preliminaries">Preliminaries</h2>
<p>Welcome to the first Brunei R User Group meetup!</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[ 65, 35 ]">
<div class="quarto-layout-row">
<div id="first-column" class="quarto-layout-cell" style="flex-basis: 65.0%;justify-content: flex-start;">
<p><br></p>
<blockquote class="blockquote">
<p>The RUGS mission is to facilitate the person-to-person exchange of knowledge in small group settings on a global scale. —R Consortium</p>
</blockquote>
</div>
<div id="second-column" class="quarto-layout-cell" style="flex-basis: 35.0%;justify-content: center;">
<p><a href="https://bruneir.github.io/bruneiR-Rlogo.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://bruneir.github.io/bruneiR-Rlogo.jpg" class="img-fluid"></a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="st">"R"</span> <span class="sc">|&gt;</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rug</span>(<span class="st">"b"</span>, _, <span class="st">"unei"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><u>About us</u></p>
<ul>
<li>A group of UBD-ians and R enthusiasts</li>
<li>We want to create a community of R users in Brunei</li>
<li>Champion the Open Source cause</li>
</ul>
<p>More events to come this year. Stay tuned!</p>
<section id="expectations" class="level3">
<h3 class="anchored" data-anchor-id="expectations">Expectations</h3>
<div class="callout callout-style-default callout-warning callout-titled" title="Outcomes">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>This is a hands-on, live-coding, lecture-style “workshop”.</li>
<li>Expect to learn (or at the very least, see me do!)…
<ol type="1">
<li>What spatial data is and why it’s important.</li>
<li>What statistical analysis can be done with spatial data.</li>
<li>How to perform spatial analysis using R.</li>
</ol></li>
<li>A basic understanding of R is assumed.</li>
</ul>
</div>
</div>
<p><a href="inspirational_cat.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="inspirational_cat.jpg" class="img-fluid"></a></p>
<p>For some, maybe it will be a bit fast-paced (sorry in advanced!). All the materials will be available online (see link on the right).</p>
<p>I’m very happy to answer questions afterwards!</p>
</section>
<section id="clone-this-repo-from-github" class="level3">
<h3 class="anchored" data-anchor-id="clone-this-repo-from-github">Clone this repo from GitHub</h3>
<p>You can access all the source files from GitHub. Click on the link at the right labelled ‘GitHub Repo’. If you already have a GitHub account, you can go ahead and clone this to your local computer. If not, you can download the files as a zip, and unzip them at a location of your choice.</p>
<p><a href="download_github.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="download_github.png" class="img-fluid"></a></p>
</section>
<section id="getting-started-with-r" class="level3">
<h3 class="anchored" data-anchor-id="getting-started-with-r">Getting started with R</h3>
<p>I’ll just talk about these points briefly:</p>
<ul>
<li>What’s the difference between R and RStudio?</li>
<li>Quick run through RStudio’s features</li>
<li>Set up a project</li>
<li>R Scripts vs Notebooks (<code>.qmd</code> or <code>.Rmd</code>)</li>
<li>Executing commands in R</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try this out for yourself!</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> N, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x)  <span class="co"># Show the first 6 elements</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8304699 0.5659743 0.7684357 0.7287764 0.1446043 0.4890953</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)  <span class="co"># Calculate the mean of this vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4900089</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>run_x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(x))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(x)) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  run_x[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(x[<span class="dv">1</span><span class="sc">:</span>i])</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run_x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8304699 1.3964442 2.1648798 2.8936562 3.0382605 3.5273558</code></pre>
</div>
</div>
</section>
<section id="list-of-packages" class="level3">
<h3 class="anchored" data-anchor-id="list-of-packages">List of packages</h3>
<p>The power of R comes from its diverse range of user-contributed packages. To install a package in R, we type <code>install.packages("package_name")</code>. As an example, try install the <code>{tidyverse}</code> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A bunch of things will happen on your screen that makes you look like a legit hacker. (It’s normal! Unles… there are some errors in the installation process 😅) Once that’s done, you will want to load the package to start using it.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># no need to use quotes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s a list of packages we will be using today. You’ll need to install all of them before we begin. In RStudio, there will be a prompt (yellow line at the top of the source pane) for you to install all these packages with a single click.</p>
<p>Furthermore, there are packages that are not yet on CRAN, but are available on GitHub. Please install them using the <code>remotes</code> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"propertypricebn/bruneimap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Of course, don’t forget to load it. For more information, please check out the package’s <a href="https://github.com/propertypricebn/bruneimap">GitHub page</a></p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bruneimap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Motivation…</p>
<section id="types-of-gis-data" class="level3">
<h3 class="anchored" data-anchor-id="types-of-gis-data">Types of GIS data</h3>
<p>Roughly speaking, there are 4 types of GIS data.</p>
<ol type="1">
<li><strong>Points</strong>
<ul>
<li>Having <span class="math inline">\((X, Y)\)</span> coordinates (latitude, longitude, or projected coordinates, and are “zero-dimensional”.</li>
<li>E.g. shopping malls, hospitals, outbreaks, etc.</li>
</ul></li>
<li><strong>Lines</strong>
<ul>
<li>A collection of points that form a path or a boundary. Has length.</li>
<li>E.g. roads, rivers, pipelines, etc.</li>
</ul></li>
<li><strong>Polygons</strong>
<ul>
<li>A closed area made up of line segments or curves.</li>
<li>E.g. countries, districts, buildings, etc.</li>
</ul></li>
<li><strong>Raster</strong>
<ul>
<li>Pixelated (or gridded) data where each pixel is associated with a geographical area and some measurement.</li>
<li>E.g. satellite images, elevation data, etc.</li>
</ul></li>
</ol>
<p>The first three are usually referred to as <em>vector data</em>. GIS data can be stored in various formats such as <code>.shp</code> or <code>.geojson</code>. The handling of GIS data (at least vector type data) is facilitated by the <code>{sf}</code> package <span class="citation" data-cites="pebesma2023spatial">(<a href="#ref-pebesma2023spatial" role="doc-biblioref">Pebesma and Bivand 2023</a>)</span> which uses the <em>simple features</em> standard.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>Simple features</em> refers to a formal standard (ISO 19125-1:2004) that describes how objects in the real world can be represented in computers, with emphasis on the spatial geometry of these objects.</p>
</div>
</div>
<p>It’s helpful to think about the shape of this spatial data set. As an example, here’s a random slice of 10 kampong-level population data for Brunei:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  kpg_sf, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  bn_census2021, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">join_by</span>(id, kampong, mukim, district)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    kampong, population, geometry</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 10 features and 2 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 114.2334 ymin: 4.299611 xmax: 115.1575 ymax: 5.044288
Geodetic CRS:  WGS 84
# A tibble: 10 × 3
   kampong                          population                          geometry
   &lt;chr&gt;                                 &lt;dbl&gt;                     &lt;POLYGON [°]&gt;
 1 Kg. Mata-Mata                          7159 ((114.9012 4.913718, 114.9013 4.…
 2 Kg. Gatas                                47 ((114.4678 4.416534, 114.4679 4.…
 3 STKRJ Mata-Mata Kawasan 3              2485 ((114.8728 4.906532, 114.8725 4.…
 4 Perumahan Negara Rimba Kawasan 2       4151 ((114.9158 4.954169, 114.9151 4.…
 5 Kg. Mendaram Kecil                       58 ((114.4898 4.339776, 114.4898 4.…
 6 Kg. Kinalong                             12 ((115.071 4.69048, 115.0711 4.69…
 7 Kg. Simbatang Batu Apoi                  NA ((115.1573 4.681658, 115.1573 4.…
 8 Kg. Telisai                            1802 ((114.5669 4.727061, 114.5684 4.…
 9 Kg. Mumong B                           3141 ((114.2598 4.579565, 114.2687 4.…
10 Tanjong Pelumpong                        NA ((115.1004 5.040252, 115.1005 5.…</code></pre>
</div>
</div>
<p>Spatial data analysis must have these two components:</p>
<ol type="1">
<li>The study variables (in the above example, this is population data).</li>
<li>GIS data regarding that study variable.</li>
</ol>
<p>If we only have 1 without 2, then it really is just a regular data analysis (stating the obvious). Adding the GIS data is a process called “geocoding” the data points.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In R, geocoding using <code>{tidyverse}</code> can be achieved using the <code>dplyr::left_join()</code> or similar <code>xxx_join()</code> family of functions.</p>
</div>
</div>
</section>
</section>
<section id="multipoint-data" class="level2">
<h2 class="anchored" data-anchor-id="multipoint-data"><code>(MULTI)POINT</code> data</h2>
<p>Using the data from <span class="citation" data-cites="jaafar2023data">Jaafar and Sukri (<a href="#ref-jaafar2023data" role="doc-biblioref">2023</a>)</span> on the physicochemical characteristics and texture classification of soil in Bornean tropical heath forests affected by exotic Acacia mangium. There are three datasets provided.</p>
<ol type="1">
<li>GIS data (<a href="https://en.wikipedia.org/wiki/World_Geodetic_System" title="World Geodetic System">WGS84</a> coordinates) of all study plots.</li>
<li>Soil physicochemical property data. This contains details of soil physical, chemical, nutrient concentration of the three habits studied.</li>
<li>Soil texture classification. Provides details on the classification of the soil texture in the habitats studied.</li>
</ol>
<p>We will first load the data sets in R.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the data sets</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>soil_gps <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/8389823/GPS - Revised.csv"</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IMPORTANT!!! The csv file has latin1 encoding as opposed to UTF-8</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> readr<span class="sc">::</span><span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"latin1"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>soil_physico <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/8389823/Soil physicochemical properties.csv"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>soil_texture <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/8389823/Soil texture classification.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="clean-up-the-point-data" class="level3">
<h3 class="anchored" data-anchor-id="clean-up-the-point-data">Clean up the point data</h3>
<p>Let’s take a look at the point data set.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(soil_gps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 18
Columns: 5
$ Forest_type  &lt;chr&gt; "Kerangas", "Kerangas", "Kerangas", "Kerangas", "Kerangas…
$ Habitat_type &lt;chr&gt; "Intact", "Intact", "Intact", "Intact", "Intact", "Intact…
$ Plot_name    &lt;chr&gt; "KU1", "KU2", "KU3", "KU4", "KU5", "KU6", "KI1", "KI2", "…
$ Latitude     &lt;chr&gt; "4° 35' 53.40\"N", "4° 35' 38.37\"N", "4° 35' 53.89\"N", …
$ Longitude    &lt;chr&gt; "114° 30' 39.09\"E", "114° 31' 05.89\"E", "114° 30' 38.90…</code></pre>
</div>
</div>
<p>The first three columns are essentially the identifiers of the plots (forest type, habitat type, and the unique identification code for the study plot). However, the latitude and longitude needs a bit of cleaning up, because it’s currently in character format. This needs to be in a formal Degree Minute Second <code>DMS</code> class that R can understand. For this we will use the <code>sp::char2dms()</code> function.</p>
<p>As an example let’s take a look at the first latitude.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> soil_gps<span class="sc">$</span>Latitude[<span class="dv">1</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "4° 35' 53.40\"N"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert it using sp::char2dms() function</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">char2dms</span>(x, <span class="at">chd =</span> <span class="st">"°"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4d35'53.4"N</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Formal class 'DMS' [package "sp"] with 5 slots
  ..@ WS : logi FALSE
  ..@ deg: int 4
  ..@ min: int 35
  ..@ sec: num 53.4
  ..@ NS : logi TRUE</code></pre>
</div>
</div>
<p>This is a special class that R understands as being a latitude from Earth. To convert it to decimal, we just do <code>as.numeric()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.598167</code></pre>
</div>
</div>
<p>Now let’s do this for all the values in the <code>soil_gps</code> data. We will use the <code>dplyr::mutate()</code> function in a pipeline.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>soil_gps <span class="ot">&lt;-</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  soil_gps <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Latitude =</span> <span class="fu">as.numeric</span>(sp<span class="sc">::</span><span class="fu">char2dms</span>(Latitude, <span class="at">chd =</span> <span class="st">"°"</span>)),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Longitude =</span> <span class="fu">as.numeric</span>(sp<span class="sc">::</span><span class="fu">char2dms</span>(Longitude, <span class="at">chd =</span> <span class="st">"°"</span>))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>soil_gps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 5
   Forest_type Habitat_type Plot_name Latitude Longitude
   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;
 1 Kerangas    Intact       KU1           4.60      115.
 2 Kerangas    Intact       KU2           4.59      115.
 3 Kerangas    Intact       KU3           4.60      115.
 4 Kerangas    Intact       KU4           4.63      114.
 5 Kerangas    Intact       KU5           4.60      115.
 6 Kerangas    Intact       KU6           4.60      115.
 7 Kerangas    Invaded      KI1           4.59      115.
 8 Kerangas    Invaded      KI2           4.59      115.
 9 Kerangas    Invaded      KI3           4.59      115.
10 Kerangas    Invaded      KI4           4.59      115.
11 Kerangas    Invaded      KI5           4.59      115.
12 Kerangas    Invaded      KI6           4.59      115.
13 Kerangas    Plantation   AP1           4.59      115.
14 Kerangas    Plantation   AP2           4.59      115.
15 Kerangas    Plantation   AP3           4.59      115.
16 Kerangas    Plantation   AP4           4.59      115.
17 Kerangas    Plantation   AP5           4.59      115.
18 Kerangas    Plantation   AP6           4.59      115.</code></pre>
</div>
</div>
</section>
<section id="preliminary-plot-of-the-data" class="level3">
<h3 class="anchored" data-anchor-id="preliminary-plot-of-the-data">Preliminary plot of the data</h3>
<p>Using the data contained in the <code>{bruneimap}</code> package, we can plot the study areas on a map of Brunei. Use either the <code>brn_sf</code>, <code>dis_sf</code>, <code>mkm_sf</code> or <code>kpg_sf</code> data sets.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(brn_sf) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> soil_gps, <span class="fu">aes</span>(Longitude, Latitude)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>We can zoom in a bit… but we have to find out manually the correct bounding box.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mkm_sf) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dis_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> soil_gps, <span class="fu">aes</span>(Longitude, Latitude)) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> soil_gps,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(Longitude, Latitude, <span class="at">label =</span> Plot_name),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="dv">30</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">114.4</span>, <span class="fl">114.6</span>),</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.7</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="merge-with-the-study-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-with-the-study-data">Merge with the study data</h3>
<p>Let’s take a look at the data set.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(soil_physico)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 144
Columns: 16
$ Habitat_type              &lt;chr&gt; "Intact", "Intact", "Intact", "Intact", "Int…
$ Plot_name                 &lt;chr&gt; "KU1", "KU1", "KU1", "KU1", "KU1", "KU1", "K…
$ Subplot_name              &lt;chr&gt; "A", "A", "B", "B", "C", "C", "D", "D", "A",…
$ Soil_depth                &lt;chr&gt; "0-15", "30-50", "0-15", "30-50", "0-15", "3…
$ Nitrogen                  &lt;dbl&gt; 0.617, 0.188, 0.663, 0.200, 0.465, 0.255, 0.…
$ Phosphorus                &lt;dbl&gt; 0.248, 0.129, 0.259, 0.295, 0.172, 0.145, 0.…
$ Magnesium                 &lt;dbl&gt; 0.000, 0.045, 0.054, 0.035, 0.079, 0.043, 0.…
$ Calcium                   &lt;dbl&gt; 0.167, 0.187, 0.148, 0.113, 0.253, 0.229, 0.…
$ Potassium                 &lt;dbl&gt; 0.059, 0.037, 0.054, 0.022, 0.098, 0.033, 0.…
$ Exchangable_magnesium     &lt;dbl&gt; 0.009, 0.004, 0.007, 0.005, 0.029, 0.014, 0.…
$ Exchangable_calcium       &lt;dbl&gt; 0.010, 0.009, 0.008, 0.009, 0.109, 0.041, 0.…
$ Exchangable_potassium     &lt;dbl&gt; 0.101, 0.085, 0.092, 0.087, 0.101, 0.090, 0.…
$ Available_phosphorus      &lt;dbl&gt; 0.012, 0.012, 0.013, 0.012, 0.013, 0.014, 0.…
$ pH                        &lt;dbl&gt; 2.3, 2.7, 2.0, 2.0, 2.6, 2.5, 2.3, 2.1, 1.0,…
$ Gravimetric_water_content &lt;dbl&gt; 5.911, 3.560, 10.860, 5.082, 6.963, 4.549, 5…
$ Organic_matter            &lt;dbl&gt; 4.559, 1.399, 4.523, 2.309, 3.131, 2.209, 3.…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(soil_texture)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 144
Columns: 8
$ Habitat_type           &lt;chr&gt; "Intact", "Intact", "Intact", "Intact", "Intact…
$ Plot_name              &lt;chr&gt; "KU1", "KU1", "KU1", "KU1", "KU2", "KU2", "KU2"…
$ Subplot_name           &lt;chr&gt; "A", "B", "C", "D", "A", "B", "C", "D", "A", "B…
$ Soil_depth             &lt;chr&gt; "0-15", "0-15", "0-15", "0-15", "0-15", "0-15",…
$ Clay                   &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 2.5, 2.5, 2.5, 0.0, 2.…
$ Silt                   &lt;dbl&gt; 2.5, 0.0, 0.0, 2.5, 0.0, 0.0, 2.5, 2.5, 7.5, 7.…
$ Sand                   &lt;dbl&gt; 97.5, 100.0, 100.0, 97.5, 100.0, 97.5, 95.0, 95…
$ Texture_classification &lt;chr&gt; "Sand", "Sand", "Sand", "Sand", "Sand", "Sand",…</code></pre>
</div>
</div>
<p>The <code>soil_physico</code> and <code>soil_texture</code> data sets contain the same columns, so we might as well merge them together. We will use the <code>dplyr::left_join()</code> function.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Actually I just want to merge these two together</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>soil_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  soil_physico,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  soil_texture,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">join_by</span>(Habitat_type, Plot_name, Subplot_name, Soil_depth)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>soil_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 144 × 20
   Habitat_type Plot_name Subplot_name Soil_depth Nitrogen Phosphorus Magnesium
   &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1 Intact       KU1       A            0-15          0.617      0.248     0    
 2 Intact       KU1       A            30-50         0.188      0.129     0.045
 3 Intact       KU1       B            0-15          0.663      0.259     0.054
 4 Intact       KU1       B            30-50         0.2        0.295     0.035
 5 Intact       KU1       C            0-15          0.465      0.172     0.079
 6 Intact       KU1       C            30-50         0.255      0.145     0.043
 7 Intact       KU1       D            0-15          0.285      0.225     0.052
 8 Intact       KU1       D            30-50         0.057      0.207     0.031
 9 Intact       KU2       A            0-15          0.37       0.135     0.038
10 Intact       KU2       A            30-50         0.114      0.168     0.021
# ℹ 134 more rows
# ℹ 13 more variables: Calcium &lt;dbl&gt;, Potassium &lt;dbl&gt;,
#   Exchangable_magnesium &lt;dbl&gt;, Exchangable_calcium &lt;dbl&gt;,
#   Exchangable_potassium &lt;dbl&gt;, Available_phosphorus &lt;dbl&gt;, pH &lt;dbl&gt;,
#   Gravimetric_water_content &lt;dbl&gt;, Organic_matter &lt;dbl&gt;, Clay &lt;dbl&gt;,
#   Silt &lt;dbl&gt;, Sand &lt;dbl&gt;, Texture_classification &lt;chr&gt;</code></pre>
</div>
</div>
<p>Once we’ve done that, the <code>soil_df</code> data set (the study variables) is actually missing the spatial data. We need to geocode it with the <code>soil_gps</code> data set. Again, <code>dplyr::left_join()</code> to the rescue!</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>soil_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  soil_df, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  soil_gps,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">join_by</span>(Habitat_type, Plot_name)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we’re in a position to plot the study variables on the map. Note that there are only 18 plots in the <code>soil_gps</code> data set, and each plot has repeated measurements. That means when we plot it, it will overlap and look like a single point. So a good thing to do is to jitter the point so it’s easier to see.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(kpg_sf) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> soil_df, </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(Longitude, Latitude, <span class="at">col =</span> Nitrogen, <span class="at">size =</span> Nitrogen, </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">shape =</span> Habitat_type),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.001</span>, <span class="at">height =</span> <span class="fl">0.001</span>, <span class="at">alpha =</span> <span class="fl">0.7</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">114.46</span>, <span class="fl">114.54</span>),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">4.58</span>, <span class="fl">4.64</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predictive-models" class="level3">
<h3 class="anchored" data-anchor-id="predictive-models">Predictive models</h3>
<p>At this stage, we probably want to consult an expert in this field, and ask what variables are important for predicting the nitrogen content in the soil, so that we can build a <em>predictive model</em>. In mathematics, a model is simply a relationship between variables, like so: <span class="math display">\[
y = f(x_1,x_2,\dots,x_p) + \epsilon
\]</span> where the <span class="math inline">\(x_1,\dots,x_p\)</span> are the input variables, and <span class="math inline">\(y\)</span> is the output variable of interest (in this case, nitrogen concentrations). No model can perfectly account for this relationship, so we add a term <span class="math inline">\(\epsilon\)</span> which represents the error in the model. Ideally this should be as small as possible.</p>
<p>Several models, ranging from classical statistical models to complex machine learning models, are possible:</p>
<ol type="1">
<li>Linear regression model – <code>lm()</code></li>
<li>Generalised additive models (GAM) <span class="citation" data-cites="wood2017generalized">(<a href="#ref-wood2017generalized" role="doc-biblioref">Wood 2017</a>)</span> – <code>mgcv::gam()</code></li>
<li>Gaussian process regression (Kriging) – <code>kernlab::gausspr()</code></li>
<li>Random forests – <code>randomForest::randomForest()</code></li>
<li>Geographically weighted regression (GWR) – <code>spgwr::gwr()</code></li>
</ol>
<p>Let’s focus on Gaussian process regression (because that’s one that I know quite well). The idea of GPR is to model the relationship between the input variables and the output variable as a multivariate Gaussian distribution: <span class="math display">\[
f(x) \sim \operatorname{N}\big(0, K(x,x')\big)
\]</span> where <span class="math inline">\(K(x,x')\)</span> is the covariance function, which measures the similarity between the input variables <span class="math inline">\(x\)</span> and <span class="math inline">\(x'\)</span>. The most common covariance function is the squared exponential function: <span class="math display">\[
K(x,x') = \exp\left(-\frac{1}{2}\sum_{i=1}^p (x_i - x'_i)^2\right).
\]</span> Let <span class="math inline">\(d\)</span> represent the “distance” between two points. Then the squared exponential kernel becomes very small when this distance <span class="math inline">\(d\)</span> is large, and very large when <span class="math inline">\(d\)</span> is small. Put another way, since elements of the matrix <span class="math inline">\(K\)</span> represent co-variability, that means two points that are close together will behave similarly, and vice versa. This is very much in line with Tobler’s first law of geography: “Everything is related to everything else, but near things are more related than distant things”.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">d =</span> x, <span class="at">Kxx =</span> y) <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(d, Kxx)) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-19-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Given the assumed behaviour of our function <span class="math inline">\(f(x)\)</span>, and what is observed from the data, we can then make predictions about the nitrogen content at unobserved locations. Skipping over a whole lot of mathematics, let’s just fit this model in R.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a model to predict Nitrogen from all numeric variables. This is</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># definitely not theory based, so just want to show the code.</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>soil_df <span class="ot">&lt;-</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  soil_df <span class="sc">|&gt;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">gausspr</span>(Nitrogen <span class="sc">~</span> ., <span class="at">data =</span> soil_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Using automatic sigma estimation (sigest) for RBF or laplace kernel </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gaussian Processes object of class "gausspr" 
Problem type: regression 

Gaussian Radial Basis kernel function. 
 Hyperparameter : sigma =  0.073382350892738 

Number of training instances learned : 144 
Train error : 0.108651374 </code></pre>
</div>
</div>
<p>Having done that, we now want to prepare a prediction data frame. Essentially, we will rasterise the study area into a predefined grid. For the other variables, we will just set them at their mean values.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>xr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">114.4</span>, <span class="fl">114.6</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">seq</span>(xr[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">0.01</span>, xr[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.01</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>yr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.7</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>yy <span class="ot">&lt;-</span> <span class="fu">seq</span>(yr[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">0.01</span>, yr[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.01</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>mean_X <span class="ot">&lt;-</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  soil_df <span class="sc">|&gt;</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean)) <span class="sc">|&gt;</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Longitude, <span class="sc">-</span>Latitude)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Longitude =</span> xx,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Latitude =</span> yy</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(mean_X)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>ypred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> pred_df)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional step: filter points that are outside of the Brunei land area.</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>pred_sf <span class="ot">&lt;-</span> </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  pred_df <span class="sc">|&gt;</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(<span class="at">y =</span> brn_sf[<span class="dv">1</span>, ])</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> pred_sf,</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> ypred, <span class="at">geometry =</span> geometry),</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"sf_coordinates"</span>,</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_raster(data = pred_df, aes(Longitude, Latitude, fill = ypred),</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#             alpha = 0.8) +</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> kpg_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dis_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> soil_gps, <span class="fu">aes</span>(Longitude, Latitude, </span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">shape =</span> Habitat_type)) <span class="sc">+</span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> soil_gps,</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(Longitude, Latitude, <span class="at">label =</span> Plot_name),</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="dv">30</span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> xr, <span class="at">ylim =</span> yr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-21-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Garbage In Garbage Out! Modelling is as much an art as it is a science. Careful consideration needs to be made as to what is considered a predictor of a variable.</p>
</div>
</div>
<!-- ```{r} -->
<!-- ggplot(kpg_sf) + -->
<!--   geom_sf(aes(fill = mukim), col = "gray50") + -->
<!--   geom_sf(data = mkm_sf, col = "black", lwd = 0.5, fill = NA) + -->
<!--   geom_sf(data = filter(kpg_sf, is.na(mukim)), fill = "gray70", col = "gray70") + -->
<!--   scale_fill_viridis_d(option = "turbo") + -->
<!--   theme(legend.position = "none")  -->
<!-- ``` -->
</section>
</section>
<section id="line-data-multilinestring" class="level2">
<h2 class="anchored" data-anchor-id="line-data-multilinestring">Line data (<code>(MULTI)LINESTRING</code>)</h2>
<p>For this example, we’ll play with the road network shape file obtained from OpenStreetMaps. The data is in geojson format, so let’s import that into R.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>brd <span class="ot">&lt;-</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>(<span class="st">"data/hotosm_brn_roads_lines_geojson/hotosm_brn_roads_lines_geojson.geojson"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>)  <span class="co"># SET THE CRS!!! (WGS84)</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(brd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 25,570
Columns: 15
$ name       &lt;chr&gt; "Simpang 393", "Simpang 405", NA, NA, NA, NA, "Lebuhraya Tu…
$ `name:en`  &lt;chr&gt; NA, NA, NA, NA, NA, NA, "Tutong–Telisai Highway", NA, NA, N…
$ highway    &lt;chr&gt; "residential", "residential", "service", "residential", "tr…
$ surface    &lt;chr&gt; NA, NA, NA, NA, NA, "asphalt", "asphalt", NA, NA, NA, "asph…
$ smoothness &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ width      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ lanes      &lt;chr&gt; NA, NA, NA, NA, NA, "1", "2", NA, NA, NA, "2", NA, NA, NA, …
$ oneway     &lt;chr&gt; NA, NA, NA, NA, NA, "yes", "yes", NA, NA, NA, "no", "yes", …
$ bridge     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ layer      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ source     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ `name:ms`  &lt;chr&gt; NA, NA, NA, NA, NA, NA, "Lebuhraya Tutong–Telisai", NA, NA,…
$ osm_id     &lt;int&gt; 386886618, 481030903, 512405939, 664532755, 442044892, 6651…
$ osm_type   &lt;chr&gt; "ways_line", "ways_line", "ways_line", "ways_line", "ways_l…
$ geometry   &lt;LINESTRING [°]&gt; LINESTRING (114.6236 4.7910..., LINESTRING (114.…</code></pre>
</div>
</div>
<p>There are 25,570 features in this data set, which may be a bit too much. Let’s try to focus on the major roads only. This information seems to be contained in the <code>highway</code> column. What’s in it?</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(brd<span class="sc">$</span>highway)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     bridleway   construction       cycleway        footway  living_street 
             1             28             73            898             10 
      motorway  motorway_link           path     pedestrian        primary 
           116            152            140             60            865 
  primary_link    residential           road      secondary secondary_link 
           332           9023              1            446             79 
       service          steps       tertiary  tertiary_link          track 
          9876             53            586             59            442 
         trunk     trunk_link   unclassified 
           460            310           1560 </code></pre>
</div>
</div>
<p>According to this <a href="https://wiki.openstreetmap.org/wiki/OpenStreetMap_Carto/Lines">wiki</a>, In OpenStreetMap, the major roads of a road network are sorted on an importance scale, from motorway to quaternary road.</p>
<p><a href="osm_roads.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="osm_roads.png" class="img-fluid"></a></p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>brd_mjr <span class="ot">&lt;-</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  brd <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(highway <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"motorway"</span>, <span class="st">"trunk"</span>, <span class="st">"primary"</span>, <span class="st">"secondary"</span>)) </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>brd_mjr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1887 features and 14 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 114.1906 ymin: 4.516642 xmax: 115.2021 ymax: 5.037115
Geodetic CRS:  WGS 84
# A tibble: 1,887 × 15
   name     `name:en` highway surface smoothness width lanes oneway bridge layer
 * &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;
 1 Lebuhra… Tutong–T… trunk   asphalt &lt;NA&gt;       &lt;NA&gt;  2     yes    &lt;NA&gt;   &lt;NA&gt; 
 2 Lebuhra… Tutong–T… trunk   asphalt &lt;NA&gt;       &lt;NA&gt;  3     yes    &lt;NA&gt;   &lt;NA&gt; 
 3 Jalan S… &lt;NA&gt;      primary asphalt &lt;NA&gt;       &lt;NA&gt;  2     yes    yes    1    
 4 Jalan S… &lt;NA&gt;      primary asphalt &lt;NA&gt;       &lt;NA&gt;  2     yes    &lt;NA&gt;   &lt;NA&gt; 
 5 Lebuh R… Seria–Be… trunk   asphalt &lt;NA&gt;       &lt;NA&gt;  2     yes    &lt;NA&gt;   &lt;NA&gt; 
 6 &lt;NA&gt;     &lt;NA&gt;      trunk   asphalt &lt;NA&gt;       &lt;NA&gt;  2     yes    &lt;NA&gt;   &lt;NA&gt; 
 7 &lt;NA&gt;     &lt;NA&gt;      primary asphalt &lt;NA&gt;       &lt;NA&gt;  1     yes    &lt;NA&gt;   &lt;NA&gt; 
 8 Lebuh R… Seria–Be… trunk   asphalt &lt;NA&gt;       &lt;NA&gt;  2     yes    yes    1    
 9 &lt;NA&gt;     &lt;NA&gt;      primary asphalt &lt;NA&gt;       &lt;NA&gt;  2     yes    &lt;NA&gt;   &lt;NA&gt; 
10 Lebuhra… Telisai–… trunk   asphalt &lt;NA&gt;       &lt;NA&gt;  2     yes    &lt;NA&gt;   &lt;NA&gt; 
# ℹ 1,877 more rows
# ℹ 5 more variables: source &lt;chr&gt;, `name:ms` &lt;chr&gt;, osm_id &lt;int&gt;,
#   osm_type &lt;chr&gt;, geometry &lt;LINESTRING [°]&gt;</code></pre>
</div>
</div>
<p>And now a plot of these roads.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> brn_sf) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> brd_mjr, <span class="fu">aes</span>(<span class="at">col =</span> highway), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_viridis_d(option = "turbo")</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  ggsci<span class="sc">::</span><span class="fu">scale_colour_npg</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>With this, I asked ChatGPT what kind of spatial analyses can be done on this data set. It said, when paired with appropriate data, we can do things like:</p>
<ol type="1">
<li><strong>Network Connectivity Analysis</strong>
<ul>
<li>Assess reachability and identify disconnected road network components.</li>
</ul></li>
<li><strong>Accessibility and Service Area Analysis</strong>
<ul>
<li>Determine service areas and catchment areas for essential services.</li>
</ul></li>
<li><strong>Traffic Simulation and Management</strong>
<ul>
<li>Simulate traffic flow to identify bottlenecks and suggest optimal routing.</li>
</ul></li>
<li><strong>Environmental Impact Assessment</strong>
<ul>
<li>Estimate vehicular emissions and model noise pollution from roads.</li>
</ul></li>
<li><strong>Urban and Regional Planning</strong>
<ul>
<li>Examine land use compatibility and assess infrastructure development needs.</li>
</ul></li>
<li><strong>Safety Analysis</strong>
<ul>
<li>Identify accident hotspots and assess pedestrian safety.</li>
</ul></li>
<li><strong>Economic Analysis</strong>
<ul>
<li>Evaluate economic accessibility and the impact of road projects.</li>
</ul></li>
</ol>
<p>Let’s pick one of these: Calculate the distance between the centroid of several regions and the major hospital in the Belait district. This analysis guides urban and healthcare planning by pinpointing areas with inadequate access to emergency services, enabling targeted infrastructure and service improvements.</p>
<section id="road-networks-in-belait-region" class="level3">
<h3 class="anchored" data-anchor-id="road-networks-in-belait-region">Road networks in Belait region</h3>
<p>First we “crop” the road network to the Belait region.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>brd_belait <span class="ot">&lt;-</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  brd <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(<span class="fu">filter</span>(dis_sf, name <span class="sc">==</span> <span class="st">"Belait"</span>))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(brd_belait) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">filter</span>(dis_sf, name <span class="sc">==</span> <span class="st">"Belait"</span>), <span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>If we were to sample random points from the Belait polygon, we might get non-sensical areas like the extremely rural areas or forest reserves. So the idea is to sample random points from the road network itself. For this, we need a function that will get us a random point on the path itself.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>get_random_point <span class="ot">&lt;-</span> <span class="cf">function</span>(linestring) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(linestring)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  samp_coord <span class="ot">&lt;-</span> coords[<span class="fu">sample</span>(<span class="fu">nrow</span>(coords), <span class="dv">1</span>), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  samp_coord[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">get_random_point</span>(brd_belait<span class="sc">$</span>geometry[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         X          Y         L1 
114.241941   4.594271   1.000000 </code></pre>
</div>
</div>
<p>Once we have this function, we need to <code>map()</code> this function onto each of the linestrings in the <code>brd_belait</code> data set. The resulting list of points is too large! So we will just sample 100 points (you can experiment with this number).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>random_points <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(brd_belait<span class="sc">$</span>geometry, get_random_point) <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>What we have now is a data frame of 100 random points on the road network in the Belait district. We will use the <code>{osrm}</code> package to calculate the distance between these points and the Suri Seri Begawan Hospital in Kuala Belait. The output will be three things: 1) The duration (minutes); 2) The distance (km); and 3) a <code>LINESTRING</code> object that represents the path to get to the hospital. Unfortunately the <code>osrmRoute()</code> function is not vectorised, i.e.&nbsp;we have to do it one-by-one for each of the 100 points. Luckily, we can just make a <code>for</code> loop and store the results in a list.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>suriseri <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">114.198778</span>, <span class="fl">4.583444</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  res[[i]] <span class="ot">&lt;-</span> <span class="fu">osrmRoute</span>(<span class="at">src =</span> random_points[i, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">dst =</span> suriseri, <span class="at">overview =</span> <span class="st">"full"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(res) <span class="sc">|&gt;</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 100 features and 4 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 114.1868 ymin: 4.39987 xmax: 114.5117 ymax: 4.68194
Geodetic CRS:  WGS 84
# A tibble: 100 × 5
   src   dst   duration distance                                        geometry
   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;                                &lt;LINESTRING [°]&gt;
 1 1     dst       5.46     2.83 (114.2083 4.57302, 114.2083 4.57302, 114.2082 …
 2 1     dst      13.4      9.07 (114.2733 4.59769, 114.2732 4.59766, 114.2732 …
 3 1     dst       9.14     6.79 (114.2502 4.58966, 114.2501 4.59037, 114.25 4.…
 4 1     dst      11.7      8.67 (114.2706 4.60023, 114.2707 4.60013, 114.2707 …
 5 1     dst      29.6     34.2  (114.4356 4.65023, 114.4356 4.65023, 114.4364 …
 6 1     dst      16.7     11.6  (114.2947 4.60751, 114.2948 4.60754, 114.2948 …
 7 1     dst       4.15     2.66 (114.2177 4.59164, 114.2177 4.59164, 114.2177 …
 8 1     dst      26.1     26.0  (114.3797 4.63288, 114.3797 4.63288, 114.3798 …
 9 1     dst       7.43     4.87 (114.2376 4.59018, 114.2373 4.5901, 114.2371 4…
10 1     dst      18.9     15.3  (114.3206 4.60654, 114.3206 4.60654, 114.3204 …
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>So with all that done, we can now plot the paths taken by the 100 random points to the hospital. The map gives us an indication of which areas are underserved by the hospital, and can guide urban and healthcare planning by pinpointing areas with inadequate access to emergency services, enabling targeted infrastructure and service improvements.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res) <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(data = random_points, aes(x = X, y = Y), col = "red") +</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">filter</span>(kpg_sf, district <span class="sc">==</span> <span class="st">"Belait"</span>), <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">col =</span> duration), <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> suriseri[<span class="dv">1</span>], <span class="at">y =</span> suriseri[<span class="dv">2</span>], <span class="at">col =</span> <span class="st">"red3"</span>, <span class="at">pch =</span> <span class="st">"X"</span>, </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-30-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Improving the analysis</p>
<ul>
<li>Weight analysis by populous areas. Outcalls to hospitals can be modelled using a Poisson distribution with the population as the rate parameter.</li>
<li>Use a more sophisticated routing algorithm that accounts for traffic conditions and road quality (am vs pm, weekends vs weekdays, etc.).</li>
<li>Simpler to analyse at the kampong or mukim level?</li>
</ul>
</section>
</section>
<section id="areal-data-multipolygons" class="level2">
<h2 class="anchored" data-anchor-id="areal-data-multipolygons">Areal data (<code>(MULTI)POLYGONS</code>)</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="What we'll learn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What we’ll learn
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Represent statistical data using colour mapping symbology (choropleth)</li>
<li>Use <code>ggplot2::geom_label()</code> or <code>ggrepel::geom_label_repel()</code> to add labels to the map</li>
<li>Using a binned colour scale, e.g.&nbsp;<code>ggplot2::geom_scale_fill_viridis_b()</code></li>
</ul>
</div>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>bn_pop_sf <span class="ot">&lt;-</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    kpg_sf, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    bn_census2021, </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(id, kampong, mukim, district</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>kpg_labels_sf <span class="ot">&lt;-</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  bn_pop_sf <span class="sc">|&gt;</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(population)) <span class="sc">|&gt;</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>bn_pop_sf <span class="sc">|&gt;</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(population &gt; 50) |&gt;</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> population), <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> kpg_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> kpg_labels_sf,</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> kampong, <span class="at">geometry =</span> geometry),</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"sf_coordinates"</span>,</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="dv">1</span>,</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="cn">Inf</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_b</span>(</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Population"</span>,</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span>comma,</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">15000</span>)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># limits = c(0, 12000)</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-31-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="index_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>


<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-jaafar2023data" class="csl-entry" role="listitem">
Jaafar, Salwana Md, and Rahayu Sukmaria Sukri. 2023. <span>“Data on the Physicochemical Characteristics and Texture Classification of Soil in <span>Bornean</span> Tropical Heath Forests Affected by Exotic <span>Acacia</span> Mangium.”</span> <em>Data in Brief</em> 51 (December). <a href="https://doi.org/10.1016/j.dib.2023.109670">https://doi.org/10.1016/j.dib.2023.109670</a>.
</div>
<div id="ref-pebesma2023spatial" class="csl-entry" role="listitem">
Pebesma, Edzer, and Roger Bivand. 2023. <em>Spatial <span>Data Science</span>: <span>With Applications</span> in <span>R</span></em>. 1st ed. New York: <span>Chapman and Hall/CRC</span>. <a href="https://doi.org/10.1201/9780429459016">https://doi.org/10.1201/9780429459016</a>.
</div>
<div id="ref-wood2017generalized" class="csl-entry" role="listitem">
Wood, Simon N. 2017. <em>Generalized <span>Additive Models</span>: <span>An Introduction</span> with <span>R</span>, <span>Second Edition</span></em>. 2nd ed. Boca Raton: <span>Chapman and Hall/CRC</span>. <a href="https://doi.org/10.1201/9781315370279">https://doi.org/10.1201/9781315370279</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb58" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Analysing spatial data using R</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> Brunei R User Group Meetup 🇧🇳</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> '9 March 2023'</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Haziq Jamil</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0003-3298-1010</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co">    email: haziq.jamil@ubd.edu.bn</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://haziqj.ml</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Universiti Brunei Darussalam</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co">    degrees: PhD</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="fu">### `https://bruneir.github.io/brm-spatial` {.unlisted}</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preliminaries</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>Welcome to the first Brunei R User Group meetup!</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>::: {layout="<span class="co">[</span><span class="ot"> 65, 35 </span><span class="co">]</span>"}</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>::: {#first-column}</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The RUGS mission is to facilitate the person-to-person exchange of knowledge in small group settings on a global scale. ---R Consortium</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a><span class="at">:::</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>::: {#second-column}</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://bruneir.github.io/bruneiR-Rlogo.jpg)</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="st">"R"</span> <span class="sc">|&gt;</span> </span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rug</span>(<span class="st">"b"</span>, _, <span class="st">"unei"</span>)</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>&lt;u&gt;About us&lt;/u&gt;</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A group of UBD-ians and R enthusiasts</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We want to create a community of R users in Brunei</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Champion the Open Source cause</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>More events to come this year. Stay tuned!</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a><span class="fu">### Expectations</span></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning title="Outcomes"}</span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This is a hands-on, live-coding, lecture-style "workshop".</span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Expect to learn (or at the very least, see me do!)...</span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a><span class="ss">    1.  </span>What spatial data is and why it's important.</span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a><span class="ss">    2.  </span>What statistical analysis can be done with spatial data.</span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a><span class="ss">    3.  </span>How to perform spatial analysis using R.</span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A basic understanding of R is assumed.</span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a><span class="al">![](inspirational_cat.jpg)</span></span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a>For some, maybe it will be a bit fast-paced (sorry in advanced!). </span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a>All the materials will be available online (see link on the right).</span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a>I'm very happy to answer questions afterwards!</span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clone this repo from GitHub</span></span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a>You can access all the source files from GitHub.</span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a>Click on the link at the right labelled 'GitHub Repo'. </span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a>If you already have a GitHub account, you can go ahead and clone this to your local computer.</span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a>If not, you can download the files as a zip, and unzip them at a location of your choice.</span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a><span class="al">![](download_github.png)</span></span>
<span id="cb58-71"><a href="#cb58-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-72"><a href="#cb58-72" aria-hidden="true" tabindex="-1"></a><span class="fu">### Getting started with R</span></span>
<span id="cb58-73"><a href="#cb58-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-74"><a href="#cb58-74" aria-hidden="true" tabindex="-1"></a>I'll just talk about these points briefly:</span>
<span id="cb58-75"><a href="#cb58-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-76"><a href="#cb58-76" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What's the difference between R and RStudio?</span>
<span id="cb58-77"><a href="#cb58-77" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Quick run through RStudio's features</span>
<span id="cb58-78"><a href="#cb58-78" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set up a project</span>
<span id="cb58-79"><a href="#cb58-79" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>R Scripts vs Notebooks (<span class="in">`.qmd`</span> or <span class="in">`.Rmd`</span>)</span>
<span id="cb58-80"><a href="#cb58-80" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Executing commands in R</span>
<span id="cb58-81"><a href="#cb58-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-84"><a href="#cb58-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-85"><a href="#cb58-85" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb58-86"><a href="#cb58-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Try this out for yourself!</span></span>
<span id="cb58-87"><a href="#cb58-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-88"><a href="#cb58-88" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb58-89"><a href="#cb58-89" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> N, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb58-90"><a href="#cb58-90" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x)  <span class="co"># Show the first 6 elements</span></span>
<span id="cb58-91"><a href="#cb58-91" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)  <span class="co"># Calculate the mean of this vector</span></span>
<span id="cb58-92"><a href="#cb58-92" aria-hidden="true" tabindex="-1"></a>run_x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(x))</span>
<span id="cb58-93"><a href="#cb58-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(x)) {</span>
<span id="cb58-94"><a href="#cb58-94" aria-hidden="true" tabindex="-1"></a>  run_x[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(x[<span class="dv">1</span><span class="sc">:</span>i])</span>
<span id="cb58-95"><a href="#cb58-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-96"><a href="#cb58-96" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(run_x)</span>
<span id="cb58-97"><a href="#cb58-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-98"><a href="#cb58-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-99"><a href="#cb58-99" aria-hidden="true" tabindex="-1"></a><span class="fu">### List of packages</span></span>
<span id="cb58-100"><a href="#cb58-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-101"><a href="#cb58-101" aria-hidden="true" tabindex="-1"></a>The power of R comes from its diverse range of user-contributed packages.</span>
<span id="cb58-102"><a href="#cb58-102" aria-hidden="true" tabindex="-1"></a>To install a package in R, we type <span class="in">`install.packages("package_name")`</span>.</span>
<span id="cb58-103"><a href="#cb58-103" aria-hidden="true" tabindex="-1"></a>As an example, try install the <span class="in">`{tidyverse}`</span> package.</span>
<span id="cb58-104"><a href="#cb58-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-107"><a href="#cb58-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-108"><a href="#cb58-108" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb58-109"><a href="#cb58-109" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb58-110"><a href="#cb58-110" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb58-111"><a href="#cb58-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-112"><a href="#cb58-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-113"><a href="#cb58-113" aria-hidden="true" tabindex="-1"></a>A bunch of things will happen on your screen that makes you look like a legit hacker.</span>
<span id="cb58-114"><a href="#cb58-114" aria-hidden="true" tabindex="-1"></a>(It's normal! Unles... there are some errors in the installation process 😅)</span>
<span id="cb58-115"><a href="#cb58-115" aria-hidden="true" tabindex="-1"></a>Once that's done, you will want to load the package to start using it.</span>
<span id="cb58-116"><a href="#cb58-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-119"><a href="#cb58-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-120"><a href="#cb58-120" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb58-121"><a href="#cb58-121" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># no need to use quotes</span></span>
<span id="cb58-122"><a href="#cb58-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-123"><a href="#cb58-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-124"><a href="#cb58-124" aria-hidden="true" tabindex="-1"></a>Here's a list of packages we will be using today. </span>
<span id="cb58-125"><a href="#cb58-125" aria-hidden="true" tabindex="-1"></a>You'll need to install all of them before we begin. </span>
<span id="cb58-126"><a href="#cb58-126" aria-hidden="true" tabindex="-1"></a>In RStudio, there will be a prompt (yellow line at the top of the source pane) for you to install all these packages with a single click.</span>
<span id="cb58-127"><a href="#cb58-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-130"><a href="#cb58-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-131"><a href="#cb58-131" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb58-132"><a href="#cb58-132" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb58-133"><a href="#cb58-133" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb58-134"><a href="#cb58-134" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())  <span class="co"># set the theme</span></span>
<span id="cb58-135"><a href="#cb58-135" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kernlab)       <span class="co"># for GPR</span></span>
<span id="cb58-136"><a href="#cb58-136" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)       <span class="co"># nice labels in plots</span></span>
<span id="cb58-137"><a href="#cb58-137" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)          <span class="co"># OSM route calculator</span></span>
<span id="cb58-138"><a href="#cb58-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-139"><a href="#cb58-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-140"><a href="#cb58-140" aria-hidden="true" tabindex="-1"></a>Furthermore, there are packages that are not yet on CRAN, but are available on GitHub. </span>
<span id="cb58-141"><a href="#cb58-141" aria-hidden="true" tabindex="-1"></a>Please install them using the <span class="in">`remotes`</span> package.</span>
<span id="cb58-142"><a href="#cb58-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-145"><a href="#cb58-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-146"><a href="#cb58-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb58-147"><a href="#cb58-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb58-148"><a href="#cb58-148" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"propertypricebn/bruneimap"</span>)</span>
<span id="cb58-149"><a href="#cb58-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-150"><a href="#cb58-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-151"><a href="#cb58-151" aria-hidden="true" tabindex="-1"></a>Of course, don't forget to load it.</span>
<span id="cb58-152"><a href="#cb58-152" aria-hidden="true" tabindex="-1"></a>For more information, please check out the package's <span class="co">[</span><span class="ot">GitHub page</span><span class="co">](https://github.com/propertypricebn/bruneimap)</span></span>
<span id="cb58-153"><a href="#cb58-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-156"><a href="#cb58-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-157"><a href="#cb58-157" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bruneimap)</span>
<span id="cb58-158"><a href="#cb58-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-159"><a href="#cb58-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-160"><a href="#cb58-160" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb58-161"><a href="#cb58-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-162"><a href="#cb58-162" aria-hidden="true" tabindex="-1"></a>Motivation...</span>
<span id="cb58-163"><a href="#cb58-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-164"><a href="#cb58-164" aria-hidden="true" tabindex="-1"></a><span class="fu">### Types of GIS data</span></span>
<span id="cb58-165"><a href="#cb58-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-166"><a href="#cb58-166" aria-hidden="true" tabindex="-1"></a>Roughly speaking, there are 4 types of GIS data.</span>
<span id="cb58-167"><a href="#cb58-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-168"><a href="#cb58-168" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Points**</span>
<span id="cb58-169"><a href="#cb58-169" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Having $(X, Y)$ coordinates (latitude, longitude, or projected coordinates, and are "zero-dimensional".</span>
<span id="cb58-170"><a href="#cb58-170" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>E.g. shopping malls, hospitals, outbreaks, etc.</span>
<span id="cb58-171"><a href="#cb58-171" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Lines**</span>
<span id="cb58-172"><a href="#cb58-172" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A collection of points that form a path or a boundary. Has length.</span>
<span id="cb58-173"><a href="#cb58-173" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>E.g. roads, rivers, pipelines, etc.</span>
<span id="cb58-174"><a href="#cb58-174" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Polygons**</span>
<span id="cb58-175"><a href="#cb58-175" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>A closed area made up of line segments or curves.</span>
<span id="cb58-176"><a href="#cb58-176" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>E.g. countries, districts, buildings, etc.</span>
<span id="cb58-177"><a href="#cb58-177" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Raster**</span>
<span id="cb58-178"><a href="#cb58-178" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Pixelated (or gridded) data where each pixel is associated with a geographical area and some measurement.</span>
<span id="cb58-179"><a href="#cb58-179" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>E.g. satellite images, elevation data, etc.</span>
<span id="cb58-180"><a href="#cb58-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-181"><a href="#cb58-181" aria-hidden="true" tabindex="-1"></a>The first three are usually referred to as *vector data*. GIS data can be stored in various formats such as `.shp` or `.geojson`. The handling of GIS data (at least vector type data) is facilitated by the `{sf}` package [@pebesma2023spatial] which uses the *simple features* standard.</span>
<span id="cb58-182"><a href="#cb58-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-183"><a href="#cb58-183" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb58-184"><a href="#cb58-184" aria-hidden="true" tabindex="-1"></a>*Simple features* refers to a formal standard (ISO 19125-1:2004) that describes how objects in the real world can be represented in computers, with emphasis on the spatial geometry of these objects.</span>
<span id="cb58-185"><a href="#cb58-185" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-186"><a href="#cb58-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-187"><a href="#cb58-187" aria-hidden="true" tabindex="-1"></a>It's helpful to think about the shape of this spatial data set. As an example, here's a random slice of 10 kampong-level population data for Brunei:</span>
<span id="cb58-188"><a href="#cb58-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-191"><a href="#cb58-191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-192"><a href="#cb58-192" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(</span>
<span id="cb58-193"><a href="#cb58-193" aria-hidden="true" tabindex="-1"></a>  kpg_sf, </span>
<span id="cb58-194"><a href="#cb58-194" aria-hidden="true" tabindex="-1"></a>  bn_census2021, </span>
<span id="cb58-195"><a href="#cb58-195" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">join_by</span>(id, kampong, mukim, district)</span>
<span id="cb58-196"><a href="#cb58-196" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb58-197"><a href="#cb58-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb58-198"><a href="#cb58-198" aria-hidden="true" tabindex="-1"></a>    kampong, population, geometry</span>
<span id="cb58-199"><a href="#cb58-199" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb58-200"><a href="#cb58-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb58-201"><a href="#cb58-201" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-202"><a href="#cb58-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-203"><a href="#cb58-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-204"><a href="#cb58-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-205"><a href="#cb58-205" aria-hidden="true" tabindex="-1"></a>Spatial data analysis must have these two components:</span>
<span id="cb58-206"><a href="#cb58-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-207"><a href="#cb58-207" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The study variables (in the above example, this is population data).</span>
<span id="cb58-208"><a href="#cb58-208" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>GIS data regarding that study variable.</span>
<span id="cb58-209"><a href="#cb58-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-210"><a href="#cb58-210" aria-hidden="true" tabindex="-1"></a>If we only have 1 without 2, then it really is just a regular data analysis (stating the obvious). Adding the GIS data is a process called "geocoding" the data points.</span>
<span id="cb58-211"><a href="#cb58-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-212"><a href="#cb58-212" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb58-213"><a href="#cb58-213" aria-hidden="true" tabindex="-1"></a>In R, geocoding using <span class="in">`{tidyverse}`</span> can be achieved using the <span class="in">`dplyr::left_join()`</span> or similar <span class="in">`xxx_join()`</span> family of functions.</span>
<span id="cb58-214"><a href="#cb58-214" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-215"><a href="#cb58-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-216"><a href="#cb58-216" aria-hidden="true" tabindex="-1"></a><span class="fu">## `(MULTI)POINT` data</span></span>
<span id="cb58-217"><a href="#cb58-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-218"><a href="#cb58-218" aria-hidden="true" tabindex="-1"></a>Using the data from @jaafar2023data on the physicochemical characteristics and texture classification of soil in Bornean tropical heath forests affected by exotic Acacia mangium.</span>
<span id="cb58-219"><a href="#cb58-219" aria-hidden="true" tabindex="-1"></a>There are three datasets provided.</span>
<span id="cb58-220"><a href="#cb58-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-221"><a href="#cb58-221" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>GIS data (<span class="co">[</span><span class="ot">WGS84</span><span class="co">](https://en.wikipedia.org/wiki/World_Geodetic_System "World Geodetic System")</span> coordinates) of all study plots.</span>
<span id="cb58-222"><a href="#cb58-222" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Soil physicochemical property data. This contains details of soil physical, chemical, nutrient concentration of the three habits studied.</span>
<span id="cb58-223"><a href="#cb58-223" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Soil texture classification. Provides details on the classification of the soil texture in the habitats studied.</span>
<span id="cb58-224"><a href="#cb58-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-225"><a href="#cb58-225" aria-hidden="true" tabindex="-1"></a>We will first load the data sets in R.</span>
<span id="cb58-226"><a href="#cb58-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-229"><a href="#cb58-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-230"><a href="#cb58-230" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the data sets</span></span>
<span id="cb58-231"><a href="#cb58-231" aria-hidden="true" tabindex="-1"></a>soil_gps <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb58-232"><a href="#cb58-232" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/8389823/GPS - Revised.csv"</span>, </span>
<span id="cb58-233"><a href="#cb58-233" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IMPORTANT!!! The csv file has latin1 encoding as opposed to UTF-8</span></span>
<span id="cb58-234"><a href="#cb58-234" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> readr<span class="sc">::</span><span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"latin1"</span>)</span>
<span id="cb58-235"><a href="#cb58-235" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-236"><a href="#cb58-236" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-237"><a href="#cb58-237" aria-hidden="true" tabindex="-1"></a>soil_physico <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/8389823/Soil physicochemical properties.csv"</span>)</span>
<span id="cb58-238"><a href="#cb58-238" aria-hidden="true" tabindex="-1"></a>soil_texture <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/8389823/Soil texture classification.csv"</span>)</span>
<span id="cb58-239"><a href="#cb58-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-240"><a href="#cb58-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-241"><a href="#cb58-241" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clean up the point data</span></span>
<span id="cb58-242"><a href="#cb58-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-243"><a href="#cb58-243" aria-hidden="true" tabindex="-1"></a>Let's take a look at the point data set.</span>
<span id="cb58-244"><a href="#cb58-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-247"><a href="#cb58-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-248"><a href="#cb58-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb58-249"><a href="#cb58-249" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(soil_gps)</span>
<span id="cb58-250"><a href="#cb58-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-251"><a href="#cb58-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-252"><a href="#cb58-252" aria-hidden="true" tabindex="-1"></a>The first three columns are essentially the identifiers of the plots (forest type, habitat type, and the unique identification code for the study plot). However, the latitude and longitude needs a bit of cleaning up, because it's currently in character format. This needs to be in a formal Degree Minute Second <span class="in">`DMS`</span> class that R can understand. For this we will use the <span class="in">`sp::char2dms()`</span> function.</span>
<span id="cb58-253"><a href="#cb58-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-254"><a href="#cb58-254" aria-hidden="true" tabindex="-1"></a>As an example let's take a look at the first latitude.</span>
<span id="cb58-255"><a href="#cb58-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-258"><a href="#cb58-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-259"><a href="#cb58-259" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb58-260"><a href="#cb58-260" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> soil_gps<span class="sc">$</span>Latitude[<span class="dv">1</span>]</span>
<span id="cb58-261"><a href="#cb58-261" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb58-262"><a href="#cb58-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-263"><a href="#cb58-263" aria-hidden="true" tabindex="-1"></a><span class="co"># convert it using sp::char2dms() function</span></span>
<span id="cb58-264"><a href="#cb58-264" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">char2dms</span>(x, <span class="at">chd =</span> <span class="st">"°"</span>)</span>
<span id="cb58-265"><a href="#cb58-265" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb58-266"><a href="#cb58-266" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x)</span>
<span id="cb58-267"><a href="#cb58-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-268"><a href="#cb58-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-269"><a href="#cb58-269" aria-hidden="true" tabindex="-1"></a>This is a special class that R understands as being a latitude from Earth. To convert it to decimal, we just do <span class="in">`as.numeric()`</span>:</span>
<span id="cb58-270"><a href="#cb58-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-273"><a href="#cb58-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-274"><a href="#cb58-274" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb58-275"><a href="#cb58-275" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(x)</span>
<span id="cb58-276"><a href="#cb58-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-277"><a href="#cb58-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-278"><a href="#cb58-278" aria-hidden="true" tabindex="-1"></a>Now let's do this for all the values in the <span class="in">`soil_gps`</span> data. We will use the <span class="in">`dplyr::mutate()`</span> function in a pipeline.</span>
<span id="cb58-279"><a href="#cb58-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-282"><a href="#cb58-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-283"><a href="#cb58-283" aria-hidden="true" tabindex="-1"></a>soil_gps <span class="ot">&lt;-</span></span>
<span id="cb58-284"><a href="#cb58-284" aria-hidden="true" tabindex="-1"></a>  soil_gps <span class="sc">|&gt;</span></span>
<span id="cb58-285"><a href="#cb58-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb58-286"><a href="#cb58-286" aria-hidden="true" tabindex="-1"></a>    <span class="at">Latitude =</span> <span class="fu">as.numeric</span>(sp<span class="sc">::</span><span class="fu">char2dms</span>(Latitude, <span class="at">chd =</span> <span class="st">"°"</span>)),</span>
<span id="cb58-287"><a href="#cb58-287" aria-hidden="true" tabindex="-1"></a>    <span class="at">Longitude =</span> <span class="fu">as.numeric</span>(sp<span class="sc">::</span><span class="fu">char2dms</span>(Longitude, <span class="at">chd =</span> <span class="st">"°"</span>))</span>
<span id="cb58-288"><a href="#cb58-288" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-289"><a href="#cb58-289" aria-hidden="true" tabindex="-1"></a>soil_gps</span>
<span id="cb58-290"><a href="#cb58-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-291"><a href="#cb58-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-292"><a href="#cb58-292" aria-hidden="true" tabindex="-1"></a><span class="fu">### Preliminary plot of the data</span></span>
<span id="cb58-293"><a href="#cb58-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-294"><a href="#cb58-294" aria-hidden="true" tabindex="-1"></a>Using the data contained in the <span class="in">`{bruneimap}`</span> package, we can plot the study areas on a map of Brunei.</span>
<span id="cb58-295"><a href="#cb58-295" aria-hidden="true" tabindex="-1"></a>Use either the <span class="in">`brn_sf`</span>, <span class="in">`dis_sf`</span>, <span class="in">`mkm_sf`</span> or <span class="in">`kpg_sf`</span> data sets.</span>
<span id="cb58-296"><a href="#cb58-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-299"><a href="#cb58-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-300"><a href="#cb58-300" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(brn_sf) <span class="sc">+</span></span>
<span id="cb58-301"><a href="#cb58-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb58-302"><a href="#cb58-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> soil_gps, <span class="fu">aes</span>(Longitude, Latitude)) </span>
<span id="cb58-303"><a href="#cb58-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-304"><a href="#cb58-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-305"><a href="#cb58-305" aria-hidden="true" tabindex="-1"></a>We can zoom in a bit... but we have to find out manually the correct bounding box.</span>
<span id="cb58-306"><a href="#cb58-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-309"><a href="#cb58-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-310"><a href="#cb58-310" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mkm_sf) <span class="sc">+</span></span>
<span id="cb58-311"><a href="#cb58-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb58-312"><a href="#cb58-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dis_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb58-313"><a href="#cb58-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> soil_gps, <span class="fu">aes</span>(Longitude, Latitude)) <span class="sc">+</span></span>
<span id="cb58-314"><a href="#cb58-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb58-315"><a href="#cb58-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> soil_gps,</span>
<span id="cb58-316"><a href="#cb58-316" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(Longitude, Latitude, <span class="at">label =</span> Plot_name),</span>
<span id="cb58-317"><a href="#cb58-317" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb58-318"><a href="#cb58-318" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="dv">30</span></span>
<span id="cb58-319"><a href="#cb58-319" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-320"><a href="#cb58-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb58-321"><a href="#cb58-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">114.4</span>, <span class="fl">114.6</span>),</span>
<span id="cb58-322"><a href="#cb58-322" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.7</span>)</span>
<span id="cb58-323"><a href="#cb58-323" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-324"><a href="#cb58-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-325"><a href="#cb58-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-326"><a href="#cb58-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-327"><a href="#cb58-327" aria-hidden="true" tabindex="-1"></a><span class="fu">### Merge with the study data</span></span>
<span id="cb58-328"><a href="#cb58-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-329"><a href="#cb58-329" aria-hidden="true" tabindex="-1"></a>Let's take a look at the data set.</span>
<span id="cb58-330"><a href="#cb58-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-333"><a href="#cb58-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-334"><a href="#cb58-334" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb58-335"><a href="#cb58-335" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(soil_physico)</span>
<span id="cb58-336"><a href="#cb58-336" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(soil_texture)</span>
<span id="cb58-337"><a href="#cb58-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-338"><a href="#cb58-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-339"><a href="#cb58-339" aria-hidden="true" tabindex="-1"></a>The <span class="in">`soil_physico`</span> and <span class="in">`soil_texture`</span> data sets contain the same columns, so we might as well merge them together. </span>
<span id="cb58-340"><a href="#cb58-340" aria-hidden="true" tabindex="-1"></a>We will use the <span class="in">`dplyr::left_join()`</span> function.</span>
<span id="cb58-341"><a href="#cb58-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-344"><a href="#cb58-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-345"><a href="#cb58-345" aria-hidden="true" tabindex="-1"></a><span class="co"># Actually I just want to merge these two together</span></span>
<span id="cb58-346"><a href="#cb58-346" aria-hidden="true" tabindex="-1"></a>soil_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb58-347"><a href="#cb58-347" aria-hidden="true" tabindex="-1"></a>  soil_physico,</span>
<span id="cb58-348"><a href="#cb58-348" aria-hidden="true" tabindex="-1"></a>  soil_texture,</span>
<span id="cb58-349"><a href="#cb58-349" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">join_by</span>(Habitat_type, Plot_name, Subplot_name, Soil_depth)</span>
<span id="cb58-350"><a href="#cb58-350" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-351"><a href="#cb58-351" aria-hidden="true" tabindex="-1"></a>soil_df</span>
<span id="cb58-352"><a href="#cb58-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-353"><a href="#cb58-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-354"><a href="#cb58-354" aria-hidden="true" tabindex="-1"></a>Once we've done that, the <span class="in">`soil_df`</span> data set (the study variables) is actually missing the spatial data. </span>
<span id="cb58-355"><a href="#cb58-355" aria-hidden="true" tabindex="-1"></a>We need to geocode it with the <span class="in">`soil_gps`</span> data set.</span>
<span id="cb58-356"><a href="#cb58-356" aria-hidden="true" tabindex="-1"></a>Again, <span class="in">`dplyr::left_join()`</span> to the rescue!</span>
<span id="cb58-357"><a href="#cb58-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-360"><a href="#cb58-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-361"><a href="#cb58-361" aria-hidden="true" tabindex="-1"></a>soil_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb58-362"><a href="#cb58-362" aria-hidden="true" tabindex="-1"></a>  soil_df, </span>
<span id="cb58-363"><a href="#cb58-363" aria-hidden="true" tabindex="-1"></a>  soil_gps,</span>
<span id="cb58-364"><a href="#cb58-364" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">join_by</span>(Habitat_type, Plot_name)</span>
<span id="cb58-365"><a href="#cb58-365" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-366"><a href="#cb58-366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-367"><a href="#cb58-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-368"><a href="#cb58-368" aria-hidden="true" tabindex="-1"></a>Now we're in a position to plot the study variables on the map.</span>
<span id="cb58-369"><a href="#cb58-369" aria-hidden="true" tabindex="-1"></a>Note that there are only 18 plots in the <span class="in">`soil_gps`</span> data set, and each plot has repeated measurements. </span>
<span id="cb58-370"><a href="#cb58-370" aria-hidden="true" tabindex="-1"></a>That means when we plot it, it will overlap and look like a single point. </span>
<span id="cb58-371"><a href="#cb58-371" aria-hidden="true" tabindex="-1"></a>So a good thing to do is to jitter the point so it's easier to see.</span>
<span id="cb58-372"><a href="#cb58-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-375"><a href="#cb58-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-376"><a href="#cb58-376" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(kpg_sf) <span class="sc">+</span></span>
<span id="cb58-377"><a href="#cb58-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb58-378"><a href="#cb58-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb58-379"><a href="#cb58-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> soil_df, </span>
<span id="cb58-380"><a href="#cb58-380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(Longitude, Latitude, <span class="at">col =</span> Nitrogen, <span class="at">size =</span> Nitrogen, </span>
<span id="cb58-381"><a href="#cb58-381" aria-hidden="true" tabindex="-1"></a>        <span class="at">shape =</span> Habitat_type),</span>
<span id="cb58-382"><a href="#cb58-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.001</span>, <span class="at">height =</span> <span class="fl">0.001</span>, <span class="at">alpha =</span> <span class="fl">0.7</span></span>
<span id="cb58-383"><a href="#cb58-383" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-384"><a href="#cb58-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb58-385"><a href="#cb58-385" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">114.46</span>, <span class="fl">114.54</span>),</span>
<span id="cb58-386"><a href="#cb58-386" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">4.58</span>, <span class="fl">4.64</span>)</span>
<span id="cb58-387"><a href="#cb58-387" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-388"><a href="#cb58-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb58-389"><a href="#cb58-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">"none"</span>)</span>
<span id="cb58-390"><a href="#cb58-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-391"><a href="#cb58-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-392"><a href="#cb58-392" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predictive models</span></span>
<span id="cb58-393"><a href="#cb58-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-394"><a href="#cb58-394" aria-hidden="true" tabindex="-1"></a>At this stage, we probably want to consult an expert in this field, and ask what variables are important for predicting the nitrogen content in the soil, so that we can build a *predictive model*.</span>
<span id="cb58-395"><a href="#cb58-395" aria-hidden="true" tabindex="-1"></a>In mathematics, a model is simply a relationship between variables, like so:</span>
<span id="cb58-396"><a href="#cb58-396" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb58-397"><a href="#cb58-397" aria-hidden="true" tabindex="-1"></a>y = f(x_1,x_2,\dots,x_p) + \epsilon</span>
<span id="cb58-398"><a href="#cb58-398" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb58-399"><a href="#cb58-399" aria-hidden="true" tabindex="-1"></a>where the $x_1,\dots,x_p$ are the input variables, and $y$ is the output variable of interest (in this case, nitrogen concentrations).</span>
<span id="cb58-400"><a href="#cb58-400" aria-hidden="true" tabindex="-1"></a>No model can perfectly account for this relationship, so we add a term $\epsilon$ which represents the error in the model.</span>
<span id="cb58-401"><a href="#cb58-401" aria-hidden="true" tabindex="-1"></a>Ideally this should be as small as possible.</span>
<span id="cb58-402"><a href="#cb58-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-403"><a href="#cb58-403" aria-hidden="true" tabindex="-1"></a>Several models, ranging from classical statistical models to complex machine learning models, are possible:</span>
<span id="cb58-404"><a href="#cb58-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-405"><a href="#cb58-405" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Linear regression model -- <span class="in">`lm()`</span></span>
<span id="cb58-406"><a href="#cb58-406" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Generalised additive models (GAM) <span class="co">[</span><span class="ot">@wood2017generalized</span><span class="co">]</span> -- <span class="in">`mgcv::gam()`</span></span>
<span id="cb58-407"><a href="#cb58-407" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Gaussian process regression (Kriging) -- <span class="in">`kernlab::gausspr()`</span></span>
<span id="cb58-408"><a href="#cb58-408" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Random forests -- <span class="in">`randomForest::randomForest()`</span></span>
<span id="cb58-409"><a href="#cb58-409" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Geographically weighted regression (GWR) -- <span class="in">`spgwr::gwr()`</span></span>
<span id="cb58-410"><a href="#cb58-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-411"><a href="#cb58-411" aria-hidden="true" tabindex="-1"></a>Let's focus on Gaussian process regression (because that's one that I know quite well).</span>
<span id="cb58-412"><a href="#cb58-412" aria-hidden="true" tabindex="-1"></a>The idea of GPR is to model the relationship between the input variables and the output variable as a multivariate Gaussian distribution:</span>
<span id="cb58-413"><a href="#cb58-413" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb58-414"><a href="#cb58-414" aria-hidden="true" tabindex="-1"></a>f(x) \sim \operatorname{N}\big(0, K(x,x')\big)</span>
<span id="cb58-415"><a href="#cb58-415" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb58-416"><a href="#cb58-416" aria-hidden="true" tabindex="-1"></a>where $K(x,x')$ is the covariance function, which measures the similarity between the input variables $x$ and $x'$.</span>
<span id="cb58-417"><a href="#cb58-417" aria-hidden="true" tabindex="-1"></a>The most common covariance function is the squared exponential function:</span>
<span id="cb58-418"><a href="#cb58-418" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb58-419"><a href="#cb58-419" aria-hidden="true" tabindex="-1"></a>K(x,x') = \exp\left(-\frac{1}{2}\sum_{i=1}^p (x_i - x'_i)^2\right).</span>
<span id="cb58-420"><a href="#cb58-420" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb58-421"><a href="#cb58-421" aria-hidden="true" tabindex="-1"></a>Let $d$ represent the "distance" between two points. </span>
<span id="cb58-422"><a href="#cb58-422" aria-hidden="true" tabindex="-1"></a>Then the squared exponential kernel becomes very small when this distance $d$ is large, and very large when $d$ is small.</span>
<span id="cb58-423"><a href="#cb58-423" aria-hidden="true" tabindex="-1"></a>Put another way, since elements of the matrix $K$ represent co-variability, that means two points that are close together will behave similarly, and vice versa.</span>
<span id="cb58-424"><a href="#cb58-424" aria-hidden="true" tabindex="-1"></a>This is very much in line with Tobler's first law of geography: "Everything is related to everything else, but near things are more related than distant things".</span>
<span id="cb58-425"><a href="#cb58-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-428"><a href="#cb58-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-429"><a href="#cb58-429" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb58-430"><a href="#cb58-430" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb58-431"><a href="#cb58-431" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">d =</span> x, <span class="at">Kxx =</span> y) <span class="sc">|&gt;</span></span>
<span id="cb58-432"><a href="#cb58-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(d, Kxx)) <span class="sc">+</span></span>
<span id="cb58-433"><a href="#cb58-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span>
<span id="cb58-434"><a href="#cb58-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-435"><a href="#cb58-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-436"><a href="#cb58-436" aria-hidden="true" tabindex="-1"></a>Given the assumed behaviour of our function $f(x)$, and what is observed from the data, we can then make predictions about the nitrogen content at unobserved locations.</span>
<span id="cb58-437"><a href="#cb58-437" aria-hidden="true" tabindex="-1"></a>Skipping over a whole lot of mathematics, let's just fit this model in R.</span>
<span id="cb58-438"><a href="#cb58-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-441"><a href="#cb58-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-442"><a href="#cb58-442" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a model to predict Nitrogen from all numeric variables. This is</span></span>
<span id="cb58-443"><a href="#cb58-443" aria-hidden="true" tabindex="-1"></a><span class="co"># definitely not theory based, so just want to show the code.</span></span>
<span id="cb58-444"><a href="#cb58-444" aria-hidden="true" tabindex="-1"></a>soil_df <span class="ot">&lt;-</span></span>
<span id="cb58-445"><a href="#cb58-445" aria-hidden="true" tabindex="-1"></a>  soil_df <span class="sc">|&gt;</span></span>
<span id="cb58-446"><a href="#cb58-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) </span>
<span id="cb58-447"><a href="#cb58-447" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">gausspr</span>(Nitrogen <span class="sc">~</span> ., <span class="at">data =</span> soil_df)</span>
<span id="cb58-448"><a href="#cb58-448" aria-hidden="true" tabindex="-1"></a>mod</span>
<span id="cb58-449"><a href="#cb58-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-450"><a href="#cb58-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-451"><a href="#cb58-451" aria-hidden="true" tabindex="-1"></a>Having done that, we now want to prepare a prediction data frame.</span>
<span id="cb58-452"><a href="#cb58-452" aria-hidden="true" tabindex="-1"></a>Essentially, we will rasterise the study area into a predefined grid.</span>
<span id="cb58-453"><a href="#cb58-453" aria-hidden="true" tabindex="-1"></a>For the other variables, we will just set them at their mean values.</span>
<span id="cb58-454"><a href="#cb58-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-457"><a href="#cb58-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-458"><a href="#cb58-458" aria-hidden="true" tabindex="-1"></a>xr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">114.4</span>, <span class="fl">114.6</span>)</span>
<span id="cb58-459"><a href="#cb58-459" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">seq</span>(xr[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">0.01</span>, xr[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.01</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb58-460"><a href="#cb58-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-461"><a href="#cb58-461" aria-hidden="true" tabindex="-1"></a>yr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.7</span>)</span>
<span id="cb58-462"><a href="#cb58-462" aria-hidden="true" tabindex="-1"></a>yy <span class="ot">&lt;-</span> <span class="fu">seq</span>(yr[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">0.01</span>, yr[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.01</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb58-463"><a href="#cb58-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-464"><a href="#cb58-464" aria-hidden="true" tabindex="-1"></a>mean_X <span class="ot">&lt;-</span> </span>
<span id="cb58-465"><a href="#cb58-465" aria-hidden="true" tabindex="-1"></a>  soil_df <span class="sc">|&gt;</span></span>
<span id="cb58-466"><a href="#cb58-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean)) <span class="sc">|&gt;</span></span>
<span id="cb58-467"><a href="#cb58-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Longitude, <span class="sc">-</span>Latitude)</span>
<span id="cb58-468"><a href="#cb58-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-469"><a href="#cb58-469" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span></span>
<span id="cb58-470"><a href="#cb58-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(</span>
<span id="cb58-471"><a href="#cb58-471" aria-hidden="true" tabindex="-1"></a>    <span class="at">Longitude =</span> xx,</span>
<span id="cb58-472"><a href="#cb58-472" aria-hidden="true" tabindex="-1"></a>    <span class="at">Latitude =</span> yy</span>
<span id="cb58-473"><a href="#cb58-473" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb58-474"><a href="#cb58-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(mean_X)</span>
<span id="cb58-475"><a href="#cb58-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-476"><a href="#cb58-476" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>ypred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> pred_df)</span>
<span id="cb58-477"><a href="#cb58-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-478"><a href="#cb58-478" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional step: filter points that are outside of the Brunei land area.</span></span>
<span id="cb58-479"><a href="#cb58-479" aria-hidden="true" tabindex="-1"></a>pred_sf <span class="ot">&lt;-</span> </span>
<span id="cb58-480"><a href="#cb58-480" aria-hidden="true" tabindex="-1"></a>  pred_df <span class="sc">|&gt;</span></span>
<span id="cb58-481"><a href="#cb58-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-482"><a href="#cb58-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(<span class="at">y =</span> brn_sf[<span class="dv">1</span>, ])</span>
<span id="cb58-483"><a href="#cb58-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-484"><a href="#cb58-484" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-485"><a href="#cb58-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(</span>
<span id="cb58-486"><a href="#cb58-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> pred_sf,</span>
<span id="cb58-487"><a href="#cb58-487" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> ypred, <span class="at">geometry =</span> geometry),</span>
<span id="cb58-488"><a href="#cb58-488" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"sf_coordinates"</span>,</span>
<span id="cb58-489"><a href="#cb58-489" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb58-490"><a href="#cb58-490" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-491"><a href="#cb58-491" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_raster(data = pred_df, aes(Longitude, Latitude, fill = ypred),</span></span>
<span id="cb58-492"><a href="#cb58-492" aria-hidden="true" tabindex="-1"></a>  <span class="co">#             alpha = 0.8) +</span></span>
<span id="cb58-493"><a href="#cb58-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> kpg_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb58-494"><a href="#cb58-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dis_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb58-495"><a href="#cb58-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> soil_gps, <span class="fu">aes</span>(Longitude, Latitude, </span>
<span id="cb58-496"><a href="#cb58-496" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">shape =</span> Habitat_type)) <span class="sc">+</span></span>
<span id="cb58-497"><a href="#cb58-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb58-498"><a href="#cb58-498" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> soil_gps,</span>
<span id="cb58-499"><a href="#cb58-499" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(Longitude, Latitude, <span class="at">label =</span> Plot_name),</span>
<span id="cb58-500"><a href="#cb58-500" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb58-501"><a href="#cb58-501" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="dv">30</span></span>
<span id="cb58-502"><a href="#cb58-502" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-503"><a href="#cb58-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb58-504"><a href="#cb58-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb58-505"><a href="#cb58-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> xr, <span class="at">ylim =</span> yr)</span>
<span id="cb58-506"><a href="#cb58-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-507"><a href="#cb58-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-508"><a href="#cb58-508" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb58-509"><a href="#cb58-509" aria-hidden="true" tabindex="-1"></a>Garbage In Garbage Out! Modelling is as much an art as it is a science. Careful consideration needs to be made as to what is considered a predictor of a variable.</span>
<span id="cb58-510"><a href="#cb58-510" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-511"><a href="#cb58-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-512"><a href="#cb58-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-513"><a href="#cb58-513" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r} --&gt;</span></span>
<span id="cb58-514"><a href="#cb58-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-515"><a href="#cb58-515" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ggplot(kpg_sf) + --&gt;</span></span>
<span id="cb58-516"><a href="#cb58-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-517"><a href="#cb58-517" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   geom_sf(aes(fill = mukim), col = "gray50") + --&gt;</span></span>
<span id="cb58-518"><a href="#cb58-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-519"><a href="#cb58-519" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   geom_sf(data = mkm_sf, col = "black", lwd = 0.5, fill = NA) + --&gt;</span></span>
<span id="cb58-520"><a href="#cb58-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-521"><a href="#cb58-521" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   geom_sf(data = filter(kpg_sf, is.na(mukim)), fill = "gray70", col = "gray70") + --&gt;</span></span>
<span id="cb58-522"><a href="#cb58-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-523"><a href="#cb58-523" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   scale_fill_viridis_d(option = "turbo") + --&gt;</span></span>
<span id="cb58-524"><a href="#cb58-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-525"><a href="#cb58-525" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   theme(legend.position = "none")  --&gt;</span></span>
<span id="cb58-526"><a href="#cb58-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-527"><a href="#cb58-527" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb58-528"><a href="#cb58-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-529"><a href="#cb58-529" aria-hidden="true" tabindex="-1"></a><span class="fu">## Line data (`(MULTI)LINESTRING`)</span></span>
<span id="cb58-530"><a href="#cb58-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-531"><a href="#cb58-531" aria-hidden="true" tabindex="-1"></a>For this example, we'll play with the road network shape file obtained from OpenStreetMaps.</span>
<span id="cb58-532"><a href="#cb58-532" aria-hidden="true" tabindex="-1"></a>The data is in geojson format, so let's import that into R.</span>
<span id="cb58-533"><a href="#cb58-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-536"><a href="#cb58-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-537"><a href="#cb58-537" aria-hidden="true" tabindex="-1"></a>brd <span class="ot">&lt;-</span> </span>
<span id="cb58-538"><a href="#cb58-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>(<span class="st">"data/hotosm_brn_roads_lines_geojson/hotosm_brn_roads_lines_geojson.geojson"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-539"><a href="#cb58-539" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>)  <span class="co"># SET THE CRS!!! (WGS84)</span></span>
<span id="cb58-540"><a href="#cb58-540" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(brd)</span>
<span id="cb58-541"><a href="#cb58-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-542"><a href="#cb58-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-543"><a href="#cb58-543" aria-hidden="true" tabindex="-1"></a>There are 25,570 features in this data set, which may be a bit too much.</span>
<span id="cb58-544"><a href="#cb58-544" aria-hidden="true" tabindex="-1"></a>Let's try to focus on the major roads only.</span>
<span id="cb58-545"><a href="#cb58-545" aria-hidden="true" tabindex="-1"></a>This information seems to be contained in the <span class="in">`highway`</span> column.</span>
<span id="cb58-546"><a href="#cb58-546" aria-hidden="true" tabindex="-1"></a>What's in it?</span>
<span id="cb58-547"><a href="#cb58-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-550"><a href="#cb58-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-551"><a href="#cb58-551" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(brd<span class="sc">$</span>highway)</span>
<span id="cb58-552"><a href="#cb58-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-553"><a href="#cb58-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-554"><a href="#cb58-554" aria-hidden="true" tabindex="-1"></a>According to this <span class="co">[</span><span class="ot">wiki</span><span class="co">](https://wiki.openstreetmap.org/wiki/OpenStreetMap_Carto/Lines)</span>, In OpenStreetMap, the major roads of a road network are sorted on an importance scale, from motorway to quaternary road.</span>
<span id="cb58-555"><a href="#cb58-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-556"><a href="#cb58-556" aria-hidden="true" tabindex="-1"></a><span class="al">![](osm_roads.png)</span></span>
<span id="cb58-557"><a href="#cb58-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-560"><a href="#cb58-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-561"><a href="#cb58-561" aria-hidden="true" tabindex="-1"></a>brd_mjr <span class="ot">&lt;-</span> </span>
<span id="cb58-562"><a href="#cb58-562" aria-hidden="true" tabindex="-1"></a>  brd <span class="sc">|&gt;</span></span>
<span id="cb58-563"><a href="#cb58-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(highway <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"motorway"</span>, <span class="st">"trunk"</span>, <span class="st">"primary"</span>, <span class="st">"secondary"</span>)) </span>
<span id="cb58-564"><a href="#cb58-564" aria-hidden="true" tabindex="-1"></a>brd_mjr</span>
<span id="cb58-565"><a href="#cb58-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-566"><a href="#cb58-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-567"><a href="#cb58-567" aria-hidden="true" tabindex="-1"></a>And now a plot of these roads.</span>
<span id="cb58-568"><a href="#cb58-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-571"><a href="#cb58-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-572"><a href="#cb58-572" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-573"><a href="#cb58-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> brn_sf) <span class="sc">+</span></span>
<span id="cb58-574"><a href="#cb58-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> brd_mjr, <span class="fu">aes</span>(<span class="at">col =</span> highway), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb58-575"><a href="#cb58-575" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_viridis_d(option = "turbo")</span></span>
<span id="cb58-576"><a href="#cb58-576" aria-hidden="true" tabindex="-1"></a>  ggsci<span class="sc">::</span><span class="fu">scale_colour_npg</span>()</span>
<span id="cb58-577"><a href="#cb58-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-578"><a href="#cb58-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-579"><a href="#cb58-579" aria-hidden="true" tabindex="-1"></a>With this, I asked ChatGPT what kind of spatial analyses can be done on this data set. </span>
<span id="cb58-580"><a href="#cb58-580" aria-hidden="true" tabindex="-1"></a>It said, when paired with appropriate data, we can do things like:</span>
<span id="cb58-581"><a href="#cb58-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-582"><a href="#cb58-582" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Network Connectivity Analysis**</span>
<span id="cb58-583"><a href="#cb58-583" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Assess reachability and identify disconnected road network components.</span>
<span id="cb58-584"><a href="#cb58-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-585"><a href="#cb58-585" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Accessibility and Service Area Analysis**</span>
<span id="cb58-586"><a href="#cb58-586" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Determine service areas and catchment areas for essential services.</span>
<span id="cb58-587"><a href="#cb58-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-588"><a href="#cb58-588" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Traffic Simulation and Management**</span>
<span id="cb58-589"><a href="#cb58-589" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Simulate traffic flow to identify bottlenecks and suggest optimal routing.</span>
<span id="cb58-590"><a href="#cb58-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-591"><a href="#cb58-591" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Environmental Impact Assessment**</span>
<span id="cb58-592"><a href="#cb58-592" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Estimate vehicular emissions and model noise pollution from roads.</span>
<span id="cb58-593"><a href="#cb58-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-594"><a href="#cb58-594" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Urban and Regional Planning**</span>
<span id="cb58-595"><a href="#cb58-595" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Examine land use compatibility and assess infrastructure development needs.</span>
<span id="cb58-596"><a href="#cb58-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-597"><a href="#cb58-597" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Safety Analysis**</span>
<span id="cb58-598"><a href="#cb58-598" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Identify accident hotspots and assess pedestrian safety.</span>
<span id="cb58-599"><a href="#cb58-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-600"><a href="#cb58-600" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**Economic Analysis**</span>
<span id="cb58-601"><a href="#cb58-601" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Evaluate economic accessibility and the impact of road projects.</span>
<span id="cb58-602"><a href="#cb58-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-603"><a href="#cb58-603" aria-hidden="true" tabindex="-1"></a>Let's pick one of these: Calculate the distance between the centroid of several regions and the major hospital in the Belait district. </span>
<span id="cb58-604"><a href="#cb58-604" aria-hidden="true" tabindex="-1"></a>This analysis guides urban and healthcare planning by pinpointing areas with inadequate access to emergency services, enabling targeted infrastructure and service improvements. </span>
<span id="cb58-605"><a href="#cb58-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-606"><a href="#cb58-606" aria-hidden="true" tabindex="-1"></a><span class="fu">### Road networks in Belait region</span></span>
<span id="cb58-607"><a href="#cb58-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-608"><a href="#cb58-608" aria-hidden="true" tabindex="-1"></a>First we "crop" the road network to the Belait region.</span>
<span id="cb58-609"><a href="#cb58-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-612"><a href="#cb58-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-613"><a href="#cb58-613" aria-hidden="true" tabindex="-1"></a>brd_belait <span class="ot">&lt;-</span> </span>
<span id="cb58-614"><a href="#cb58-614" aria-hidden="true" tabindex="-1"></a>  brd <span class="sc">|&gt;</span></span>
<span id="cb58-615"><a href="#cb58-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(<span class="fu">filter</span>(dis_sf, name <span class="sc">==</span> <span class="st">"Belait"</span>))</span>
<span id="cb58-616"><a href="#cb58-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-617"><a href="#cb58-617" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(brd_belait) <span class="sc">+</span></span>
<span id="cb58-618"><a href="#cb58-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb58-619"><a href="#cb58-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">filter</span>(dis_sf, name <span class="sc">==</span> <span class="st">"Belait"</span>), <span class="at">fill =</span> <span class="cn">NA</span>)</span>
<span id="cb58-620"><a href="#cb58-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-621"><a href="#cb58-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-622"><a href="#cb58-622" aria-hidden="true" tabindex="-1"></a>If we were to sample random points from the Belait polygon, we might get non-sensical areas like the extremely rural areas or forest reserves.</span>
<span id="cb58-623"><a href="#cb58-623" aria-hidden="true" tabindex="-1"></a>So the idea is to sample random points from the road network itself.</span>
<span id="cb58-624"><a href="#cb58-624" aria-hidden="true" tabindex="-1"></a>For this, we need a function that will get us a random point on the path itself.</span>
<span id="cb58-625"><a href="#cb58-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-628"><a href="#cb58-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-629"><a href="#cb58-629" aria-hidden="true" tabindex="-1"></a>get_random_point <span class="ot">&lt;-</span> <span class="cf">function</span>(linestring) {</span>
<span id="cb58-630"><a href="#cb58-630" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(linestring)</span>
<span id="cb58-631"><a href="#cb58-631" aria-hidden="true" tabindex="-1"></a>  samp_coord <span class="ot">&lt;-</span> coords[<span class="fu">sample</span>(<span class="fu">nrow</span>(coords), <span class="dv">1</span>), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb58-632"><a href="#cb58-632" aria-hidden="true" tabindex="-1"></a>  samp_coord[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb58-633"><a href="#cb58-633" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-634"><a href="#cb58-634" aria-hidden="true" tabindex="-1"></a><span class="fu">get_random_point</span>(brd_belait<span class="sc">$</span>geometry[<span class="dv">1</span>])</span>
<span id="cb58-635"><a href="#cb58-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-636"><a href="#cb58-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-637"><a href="#cb58-637" aria-hidden="true" tabindex="-1"></a>Once we have this function, we need to <span class="in">`map()`</span> this function onto each of the linestrings in the <span class="in">`brd_belait`</span> data set.</span>
<span id="cb58-638"><a href="#cb58-638" aria-hidden="true" tabindex="-1"></a>The resulting list of points is too large! </span>
<span id="cb58-639"><a href="#cb58-639" aria-hidden="true" tabindex="-1"></a>So we will just sample 100 points (you can experiment with this number).</span>
<span id="cb58-640"><a href="#cb58-640" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb58-643"><a href="#cb58-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-644"><a href="#cb58-644" aria-hidden="true" tabindex="-1"></a>random_points <span class="ot">&lt;-</span></span>
<span id="cb58-645"><a href="#cb58-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(brd_belait<span class="sc">$</span>geometry, get_random_point) <span class="sc">|&gt;</span></span>
<span id="cb58-646"><a href="#cb58-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb58-647"><a href="#cb58-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb58-648"><a href="#cb58-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-649"><a href="#cb58-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-650"><a href="#cb58-650" aria-hidden="true" tabindex="-1"></a>What we have now is a data frame of 100 random points on the road network in the Belait district.</span>
<span id="cb58-651"><a href="#cb58-651" aria-hidden="true" tabindex="-1"></a>We will use the <span class="in">`{osrm}`</span> package to calculate the distance between these points and the Suri Seri Begawan Hospital in Kuala Belait.</span>
<span id="cb58-652"><a href="#cb58-652" aria-hidden="true" tabindex="-1"></a>The output will be three things: 1) The duration (minutes); 2) The distance (km); and 3) a <span class="in">`LINESTRING`</span> object that represents the path to get to the hospital.</span>
<span id="cb58-653"><a href="#cb58-653" aria-hidden="true" tabindex="-1"></a>Unfortunately the <span class="in">`osrmRoute()`</span> function is not vectorised, i.e. we have to do it one-by-one for each of the 100 points.</span>
<span id="cb58-654"><a href="#cb58-654" aria-hidden="true" tabindex="-1"></a>Luckily, we can just make a <span class="in">`for`</span> loop and store the results in a list.</span>
<span id="cb58-655"><a href="#cb58-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-658"><a href="#cb58-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-659"><a href="#cb58-659" aria-hidden="true" tabindex="-1"></a>suriseri <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">114.198778</span>, <span class="fl">4.583444</span>)</span>
<span id="cb58-660"><a href="#cb58-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-661"><a href="#cb58-661" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb58-662"><a href="#cb58-662" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb58-663"><a href="#cb58-663" aria-hidden="true" tabindex="-1"></a>  res[[i]] <span class="ot">&lt;-</span> <span class="fu">osrmRoute</span>(<span class="at">src =</span> random_points[i, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">dst =</span> suriseri, <span class="at">overview =</span> <span class="st">"full"</span>)</span>
<span id="cb58-664"><a href="#cb58-664" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-665"><a href="#cb58-665" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> </span>
<span id="cb58-666"><a href="#cb58-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(res) <span class="sc">|&gt;</span></span>
<span id="cb58-667"><a href="#cb58-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb58-668"><a href="#cb58-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb58-669"><a href="#cb58-669" aria-hidden="true" tabindex="-1"></a>res</span>
<span id="cb58-670"><a href="#cb58-670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-671"><a href="#cb58-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-672"><a href="#cb58-672" aria-hidden="true" tabindex="-1"></a>So with all that done, we can now plot the paths taken by the 100 random points to the hospital. </span>
<span id="cb58-673"><a href="#cb58-673" aria-hidden="true" tabindex="-1"></a>The map gives us an indication of which areas are underserved by the hospital, and can guide urban and healthcare planning by pinpointing areas with inadequate access to emergency services, enabling targeted infrastructure and service improvements.</span>
<span id="cb58-674"><a href="#cb58-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-677"><a href="#cb58-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-678"><a href="#cb58-678" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res) <span class="sc">+</span></span>
<span id="cb58-679"><a href="#cb58-679" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(data = random_points, aes(x = X, y = Y), col = "red") +</span></span>
<span id="cb58-680"><a href="#cb58-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">filter</span>(kpg_sf, district <span class="sc">==</span> <span class="st">"Belait"</span>), <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb58-681"><a href="#cb58-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">col =</span> duration), <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb58-682"><a href="#cb58-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> suriseri[<span class="dv">1</span>], <span class="at">y =</span> suriseri[<span class="dv">2</span>], <span class="at">col =</span> <span class="st">"red3"</span>, <span class="at">pch =</span> <span class="st">"X"</span>, </span>
<span id="cb58-683"><a href="#cb58-683" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb58-684"><a href="#cb58-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>() </span>
<span id="cb58-685"><a href="#cb58-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-686"><a href="#cb58-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-687"><a href="#cb58-687" aria-hidden="true" tabindex="-1"></a>Improving the analysis</span>
<span id="cb58-688"><a href="#cb58-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-689"><a href="#cb58-689" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Weight analysis by populous areas. Outcalls to hospitals can be modelled using a Poisson distribution with the population as the rate parameter.</span>
<span id="cb58-690"><a href="#cb58-690" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use a more sophisticated routing algorithm that accounts for traffic conditions and road quality (am vs pm, weekends vs weekdays, etc.).</span>
<span id="cb58-691"><a href="#cb58-691" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Simpler to analyse at the kampong or mukim level? </span>
<span id="cb58-692"><a href="#cb58-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-693"><a href="#cb58-693" aria-hidden="true" tabindex="-1"></a><span class="fu">## Areal data (`(MULTI)POLYGONS`)</span></span>
<span id="cb58-694"><a href="#cb58-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-695"><a href="#cb58-695" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="What we'll learn"}</span>
<span id="cb58-696"><a href="#cb58-696" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Represent statistical data using colour mapping symbology (choropleth)</span>
<span id="cb58-697"><a href="#cb58-697" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use <span class="in">`ggplot2::geom_label()`</span> or <span class="in">`ggrepel::geom_label_repel()`</span> to add labels to the map</span>
<span id="cb58-698"><a href="#cb58-698" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using a binned colour scale, e.g. <span class="in">`ggplot2::geom_scale_fill_viridis_b()`</span></span>
<span id="cb58-699"><a href="#cb58-699" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-700"><a href="#cb58-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-703"><a href="#cb58-703" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-704"><a href="#cb58-704" aria-hidden="true" tabindex="-1"></a>bn_pop_sf <span class="ot">&lt;-</span> </span>
<span id="cb58-705"><a href="#cb58-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb58-706"><a href="#cb58-706" aria-hidden="true" tabindex="-1"></a>    kpg_sf, </span>
<span id="cb58-707"><a href="#cb58-707" aria-hidden="true" tabindex="-1"></a>    bn_census2021, </span>
<span id="cb58-708"><a href="#cb58-708" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(id, kampong, mukim, district</span>
<span id="cb58-709"><a href="#cb58-709" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb58-710"><a href="#cb58-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-711"><a href="#cb58-711" aria-hidden="true" tabindex="-1"></a>kpg_labels_sf <span class="ot">&lt;-</span></span>
<span id="cb58-712"><a href="#cb58-712" aria-hidden="true" tabindex="-1"></a>  bn_pop_sf <span class="sc">|&gt;</span></span>
<span id="cb58-713"><a href="#cb58-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(population)) <span class="sc">|&gt;</span></span>
<span id="cb58-714"><a href="#cb58-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb58-715"><a href="#cb58-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-716"><a href="#cb58-716" aria-hidden="true" tabindex="-1"></a>bn_pop_sf <span class="sc">|&gt;</span></span>
<span id="cb58-717"><a href="#cb58-717" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(population &gt; 50) |&gt;</span></span>
<span id="cb58-718"><a href="#cb58-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-719"><a href="#cb58-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> population), <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb58-720"><a href="#cb58-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> kpg_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb58-721"><a href="#cb58-721" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb58-722"><a href="#cb58-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> kpg_labels_sf,</span>
<span id="cb58-723"><a href="#cb58-723" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> kampong, <span class="at">geometry =</span> geometry),</span>
<span id="cb58-724"><a href="#cb58-724" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"sf_coordinates"</span>,</span>
<span id="cb58-725"><a href="#cb58-725" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb58-726"><a href="#cb58-726" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="dv">1</span>,</span>
<span id="cb58-727"><a href="#cb58-727" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb58-728"><a href="#cb58-728" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="cn">Inf</span></span>
<span id="cb58-729"><a href="#cb58-729" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-730"><a href="#cb58-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_b</span>(</span>
<span id="cb58-731"><a href="#cb58-731" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Population"</span>,</span>
<span id="cb58-732"><a href="#cb58-732" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb58-733"><a href="#cb58-733" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span>comma,</span>
<span id="cb58-734"><a href="#cb58-734" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">15000</span>)</span>
<span id="cb58-735"><a href="#cb58-735" aria-hidden="true" tabindex="-1"></a>    <span class="co"># limits = c(0, 12000)</span></span>
<span id="cb58-736"><a href="#cb58-736" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-737"><a href="#cb58-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb58-738"><a href="#cb58-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","loop":false,"descPosition":"bottom","closeEffect":"zoom","openEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>